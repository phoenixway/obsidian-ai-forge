// src/renderers/ToolMessageRenderer.ts
import { setIcon } from "obsidian";
import { BaseMessageRenderer } from "./BaseMessageRenderer";
import { CSS_CLASSES } from "../constants"; // Адаптуйте шлях
export class ToolMessageRenderer extends BaseMessageRenderer {
    constructor(app, plugin, message, view) {
        super(app, plugin, message, view);
    }
    render() {
        const messageGroupEl = this.createMessageGroupWrapper([CSS_CLASSES.TOOL_MESSAGE_GROUP || "tool-message-group"]);
        this.addAvatar(messageGroupEl, false);
        const messageWrapperEl = messageGroupEl.createDiv({ cls: CSS_CLASSES.MESSAGE_WRAPPER });
        const { messageEl, contentContainer, contentEl } = this.createMessageBubble(messageWrapperEl, [CSS_CLASSES.TOOL_MESSAGE]);
        this.renderToolSpecificContent(contentEl, this.message.content);
        BaseMessageRenderer.addTimestamp(messageEl, this.message.timestamp, this.view);
        this.addBaseActionButtons(messageEl, this.message.content); // Передаємо оригінальний контент з маркерами, якщо кнопки копіювання мають копіювати саме його
        return messageGroupEl;
    }
    renderToolSpecificContent(contentEl, rawContentWithMarkers) {
        contentEl.empty();
        const toolHeader = contentEl.createDiv({ cls: CSS_CLASSES.TOOL_RESULT_HEADER });
        const iconSpan = toolHeader.createSpan({ cls: CSS_CLASSES.TOOL_RESULT_ICON });
        setIcon(iconSpan, "wrench");
        toolHeader.createSpan({
            text: `Tool Executed: ${this.message.name || "Unknown Tool"}`,
        });
        const preEl = contentEl.createEl("pre", { cls: CSS_CLASSES.TOOL_RESULT_CONTENT });
        const codeEl = preEl.createEl("code");
        let displayContent = rawContentWithMarkers;
        const toolResultStartMarker = "[TOOL_RESULT]\n";
        const toolResultEndMarker = "\n[/TOOL_RESULT]";
        const toolErrorStartMarker = "[TOOL_ERROR]\n";
        const toolErrorEndMarker = "\n[/TOOL_ERROR]";
        if (displayContent.startsWith(toolResultStartMarker) && displayContent.endsWith(toolResultEndMarker)) {
            displayContent = displayContent.substring(toolResultStartMarker.length, displayContent.length - toolResultEndMarker.length);
        }
        else if (displayContent.startsWith(toolErrorStartMarker) && displayContent.endsWith(toolErrorEndMarker)) {
            displayContent = displayContent.substring(toolErrorStartMarker.length, displayContent.length - toolErrorEndMarker.length);
            // Можна додати спеціальну стилізацію для помилок інструменту тут, якщо потрібно
            // Наприклад, додати клас до preEl або codeEl
            preEl.addClass("tool-execution-error-display"); // Приклад класу
        }
        codeEl.setText(displayContent.trim());
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVG9vbE1lc3NhZ2VSZW5kZXJlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlRvb2xNZXNzYWdlUmVuZGVyZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsdUNBQXVDO0FBQ3ZDLE9BQU8sRUFBeUIsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBSTFELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTVELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxjQUFjLENBQUMsQ0FBQyxpQkFBaUI7QUFHN0QsTUFBTSxPQUFPLG1CQUFvQixTQUFRLG1CQUFtQjtJQUMxRCxZQUFZLEdBQVEsRUFBRSxNQUFvQixFQUFFLE9BQWdCLEVBQUUsSUFBZ0I7UUFDNUUsS0FBSyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFTSxNQUFNO1FBQ1gsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUMsV0FBVyxDQUFDLGtCQUFrQixJQUFJLG9CQUFvQixDQUFDLENBQUMsQ0FBQztRQUNoSCxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN0QyxNQUFNLGdCQUFnQixHQUFHLGNBQWMsQ0FBQyxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsV0FBVyxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUM7UUFDeEYsTUFBTSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQ3ZFLGdCQUFnQixFQUNoQixDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FDN0IsQ0FBQztRQUVGLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVoRSxtQkFBbUIsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQywrRkFBK0Y7UUFFM0osT0FBTyxjQUFjLENBQUM7SUFDeEIsQ0FBQztJQUVXLHlCQUF5QixDQUFDLFNBQXNCLEVBQUUscUJBQTZCO1FBQ3pGLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUVsQixNQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUUsR0FBRyxFQUFFLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUM7UUFDaEYsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxXQUFXLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO1FBQzlFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDNUIsVUFBVSxDQUFDLFVBQVUsQ0FBQztZQUNwQixJQUFJLEVBQUUsa0JBQWtCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLGNBQWMsRUFBRTtTQUM5RCxDQUFDLENBQUM7UUFFSCxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxXQUFXLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO1FBQ2xGLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFdEMsSUFBSSxjQUFjLEdBQUcscUJBQXFCLENBQUM7UUFDM0MsTUFBTSxxQkFBcUIsR0FBRyxpQkFBaUIsQ0FBQztRQUNoRCxNQUFNLG1CQUFtQixHQUFHLGtCQUFrQixDQUFDO1FBQy9DLE1BQU0sb0JBQW9CLEdBQUcsZ0JBQWdCLENBQUM7UUFDOUMsTUFBTSxrQkFBa0IsR0FBRyxpQkFBaUIsQ0FBQztRQUU3QyxJQUFJLGNBQWMsQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsSUFBSSxjQUFjLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQztZQUNuRyxjQUFjLEdBQUcsY0FBYyxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEVBQUUsY0FBYyxDQUFDLE1BQU0sR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoSSxDQUFDO2FBQU0sSUFBSSxjQUFjLENBQUMsVUFBVSxDQUFDLG9CQUFvQixDQUFDLElBQUksY0FBYyxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLENBQUM7WUFDeEcsY0FBYyxHQUFHLGNBQWMsQ0FBQyxTQUFTLENBQUMsb0JBQW9CLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxNQUFNLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUgsZ0ZBQWdGO1lBQ2hGLDZDQUE2QztZQUM3QyxLQUFLLENBQUMsUUFBUSxDQUFDLDhCQUE4QixDQUFDLENBQUMsQ0FBQyxnQkFBZ0I7UUFDcEUsQ0FBQztRQUVELE1BQU0sQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDeEMsQ0FBQztDQVdGIiwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3JlbmRlcmVycy9Ub29sTWVzc2FnZVJlbmRlcmVyLnRzXG5pbXBvcnQgeyBBcHAsIE1hcmtkb3duUmVuZGVyZXIsIHNldEljb24gfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBPbGxhbWFQbHVnaW4gZnJvbSBcIi4uL21haW5cIjsgLy8g0JDQtNCw0L/RgtGD0LnRgtC1INGI0LvRj9GFLCDRj9C60YnQviDQv9C+0YLRgNGW0LHQvdC+ICjQvdCw0L/RgC4gXCJAL21haW5cIilcbmltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tIFwiLi4vdHlwZXNcIjsgLy8g0JDQtNCw0L/RgtGD0LnRgtC1INGI0LvRj9GFXG5pbXBvcnQgeyBPbGxhbWFWaWV3IH0gZnJvbSBcIi4uL09sbGFtYVZpZXdcIjsgLy8g0JDQtNCw0L/RgtGD0LnRgtC1INGI0LvRj9GFXG5pbXBvcnQgeyBCYXNlTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vQmFzZU1lc3NhZ2VSZW5kZXJlclwiO1xuaW1wb3J0ICogYXMgUmVuZGVyZXJVdGlscyBmcm9tIFwiLi4vTWVzc2FnZVJlbmRlcmVyVXRpbHNcIjsgLy8g0JDQtNCw0L/RgtGD0LnRgtC1INGI0LvRj9GFXG5pbXBvcnQgeyBDU1NfQ0xBU1NFUyB9IGZyb20gXCIuLi9jb25zdGFudHNcIjsgLy8g0JDQtNCw0L/RgtGD0LnRgtC1INGI0LvRj9GFXG5pbXBvcnQgeyBJTWVzc2FnZVJlbmRlcmVyIH0gZnJvbSBcIi4vSU1lc3NhZ2VSZW5kZXJlclwiO1xuXG5leHBvcnQgY2xhc3MgVG9vbE1lc3NhZ2VSZW5kZXJlciBleHRlbmRzIEJhc2VNZXNzYWdlUmVuZGVyZXIgaW1wbGVtZW50cyBJTWVzc2FnZVJlbmRlcmVyIHtcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogT2xsYW1hUGx1Z2luLCBtZXNzYWdlOiBNZXNzYWdlLCB2aWV3OiBPbGxhbWFWaWV3KSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4sIG1lc3NhZ2UsIHZpZXcpO1xuICB9XG5cbiAgcHVibGljIHJlbmRlcigpOiBIVE1MRWxlbWVudCB7XG4gICAgY29uc3QgbWVzc2FnZUdyb3VwRWwgPSB0aGlzLmNyZWF0ZU1lc3NhZ2VHcm91cFdyYXBwZXIoW0NTU19DTEFTU0VTLlRPT0xfTUVTU0FHRV9HUk9VUCB8fCBcInRvb2wtbWVzc2FnZS1ncm91cFwiXSk7XG4gICAgdGhpcy5hZGRBdmF0YXIobWVzc2FnZUdyb3VwRWwsIGZhbHNlKTsgXG4gICAgY29uc3QgbWVzc2FnZVdyYXBwZXJFbCA9IG1lc3NhZ2VHcm91cEVsLmNyZWF0ZURpdih7IGNsczogQ1NTX0NMQVNTRVMuTUVTU0FHRV9XUkFQUEVSIH0pO1xuICAgIGNvbnN0IHsgbWVzc2FnZUVsLCBjb250ZW50Q29udGFpbmVyLCBjb250ZW50RWwgfSA9IHRoaXMuY3JlYXRlTWVzc2FnZUJ1YmJsZShcbiAgICAgICAgbWVzc2FnZVdyYXBwZXJFbCxcbiAgICAgICAgW0NTU19DTEFTU0VTLlRPT0xfTUVTU0FHRV0gXG4gICAgKTtcblxuICAgIHRoaXMucmVuZGVyVG9vbFNwZWNpZmljQ29udGVudChjb250ZW50RWwsIHRoaXMubWVzc2FnZS5jb250ZW50KTtcblxuICAgIEJhc2VNZXNzYWdlUmVuZGVyZXIuYWRkVGltZXN0YW1wKG1lc3NhZ2VFbCwgdGhpcy5tZXNzYWdlLnRpbWVzdGFtcCwgdGhpcy52aWV3KTtcbiAgICB0aGlzLmFkZEJhc2VBY3Rpb25CdXR0b25zKG1lc3NhZ2VFbCwgdGhpcy5tZXNzYWdlLmNvbnRlbnQpOyAvLyDQn9C10YDQtdC00LDRlNC80L4g0L7RgNC40LPRltC90LDQu9GM0L3QuNC5INC60L7QvdGC0LXQvdGCINC3INC80LDRgNC60LXRgNCw0LzQuCwg0Y/QutGJ0L4g0LrQvdC+0L/QutC4INC60L7Qv9GW0Y7QstCw0L3QvdGPINC80LDRjtGC0Ywg0LrQvtC/0ZbRjtCy0LDRgtC4INGB0LDQvNC1INC50L7Qs9C+XG5cbiAgICByZXR1cm4gbWVzc2FnZUdyb3VwRWw7XG4gIH1cblxuICAgIHByb3RlY3RlZCByZW5kZXJUb29sU3BlY2lmaWNDb250ZW50KGNvbnRlbnRFbDogSFRNTEVsZW1lbnQsIHJhd0NvbnRlbnRXaXRoTWFya2Vyczogc3RyaW5nKTogdm9pZCB7XG4gICAgY29udGVudEVsLmVtcHR5KCk7IFxuXG4gICAgY29uc3QgdG9vbEhlYWRlciA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6IENTU19DTEFTU0VTLlRPT0xfUkVTVUxUX0hFQURFUiB9KTtcbiAgICBjb25zdCBpY29uU3BhbiA9IHRvb2xIZWFkZXIuY3JlYXRlU3Bhbih7IGNsczogQ1NTX0NMQVNTRVMuVE9PTF9SRVNVTFRfSUNPTiB9KTtcbiAgICBzZXRJY29uKGljb25TcGFuLCBcIndyZW5jaFwiKTsgXG4gICAgdG9vbEhlYWRlci5jcmVhdGVTcGFuKHtcbiAgICAgIHRleHQ6IGBUb29sIEV4ZWN1dGVkOiAke3RoaXMubWVzc2FnZS5uYW1lIHx8IFwiVW5rbm93biBUb29sXCJ9YCwgXG4gICAgfSk7XG5cbiAgICBjb25zdCBwcmVFbCA9IGNvbnRlbnRFbC5jcmVhdGVFbChcInByZVwiLCB7IGNsczogQ1NTX0NMQVNTRVMuVE9PTF9SRVNVTFRfQ09OVEVOVCB9KTtcbiAgICBjb25zdCBjb2RlRWwgPSBwcmVFbC5jcmVhdGVFbChcImNvZGVcIik7XG5cbiAgICBsZXQgZGlzcGxheUNvbnRlbnQgPSByYXdDb250ZW50V2l0aE1hcmtlcnM7XG4gICAgY29uc3QgdG9vbFJlc3VsdFN0YXJ0TWFya2VyID0gXCJbVE9PTF9SRVNVTFRdXFxuXCI7XG4gICAgY29uc3QgdG9vbFJlc3VsdEVuZE1hcmtlciA9IFwiXFxuWy9UT09MX1JFU1VMVF1cIjtcbiAgICBjb25zdCB0b29sRXJyb3JTdGFydE1hcmtlciA9IFwiW1RPT0xfRVJST1JdXFxuXCI7XG4gICAgY29uc3QgdG9vbEVycm9yRW5kTWFya2VyID0gXCJcXG5bL1RPT0xfRVJST1JdXCI7XG5cbiAgICBpZiAoZGlzcGxheUNvbnRlbnQuc3RhcnRzV2l0aCh0b29sUmVzdWx0U3RhcnRNYXJrZXIpICYmIGRpc3BsYXlDb250ZW50LmVuZHNXaXRoKHRvb2xSZXN1bHRFbmRNYXJrZXIpKSB7XG4gICAgICAgIGRpc3BsYXlDb250ZW50ID0gZGlzcGxheUNvbnRlbnQuc3Vic3RyaW5nKHRvb2xSZXN1bHRTdGFydE1hcmtlci5sZW5ndGgsIGRpc3BsYXlDb250ZW50Lmxlbmd0aCAtIHRvb2xSZXN1bHRFbmRNYXJrZXIubGVuZ3RoKTtcbiAgICB9IGVsc2UgaWYgKGRpc3BsYXlDb250ZW50LnN0YXJ0c1dpdGgodG9vbEVycm9yU3RhcnRNYXJrZXIpICYmIGRpc3BsYXlDb250ZW50LmVuZHNXaXRoKHRvb2xFcnJvckVuZE1hcmtlcikpIHtcbiAgICAgICAgZGlzcGxheUNvbnRlbnQgPSBkaXNwbGF5Q29udGVudC5zdWJzdHJpbmcodG9vbEVycm9yU3RhcnRNYXJrZXIubGVuZ3RoLCBkaXNwbGF5Q29udGVudC5sZW5ndGggLSB0b29sRXJyb3JFbmRNYXJrZXIubGVuZ3RoKTtcbiAgICAgICAgLy8g0JzQvtC20L3QsCDQtNC+0LTQsNGC0Lgg0YHQv9C10YbRltCw0LvRjNC90YMg0YHRgtC40LvRltC30LDRhtGW0Y4g0LTQu9GPINC/0L7QvNC40LvQvtC6INGW0L3RgdGC0YDRg9C80LXQvdGC0YMg0YLRg9GCLCDRj9C60YnQviDQv9C+0YLRgNGW0LHQvdC+XG4gICAgICAgIC8vINCd0LDQv9GA0LjQutC70LDQtCwg0LTQvtC00LDRgtC4INC60LvQsNGBINC00L4gcHJlRWwg0LDQsdC+IGNvZGVFbFxuICAgICAgICBwcmVFbC5hZGRDbGFzcyhcInRvb2wtZXhlY3V0aW9uLWVycm9yLWRpc3BsYXlcIik7IC8vINCf0YDQuNC60LvQsNC0INC60LvQsNGB0YNcbiAgICB9XG4gICAgXG4gICAgY29kZUVsLnNldFRleHQoZGlzcGxheUNvbnRlbnQudHJpbSgpKTtcbiAgfVxuXG4gIC8vINCf0LXRgNC10LLQuNC30L3QsNGH0LDRlNC80L4gYWRkQXZhdGFyLCDRj9C60YnQviDQv9C+0YLRgNGW0LHQvdCwINC+0YHQvtCx0LvQuNCy0LAg0LvQvtCz0ZbQutCwINC00LvRjyDQsNCy0LDRgtCw0YDQsCDRltC90YHRgtGA0YPQvNC10L3RgtGDLlxuICAvLyDQr9C60YnQviDRgdGC0LDQvdC00LDRgNGC0L3QvtGXINC70L7Qs9GW0LrQuCDQtyBCYXNlTWVzc2FnZVJlbmRlcmVyICsgUmVuZGVyZXJVdGlscy5yZW5kZXJBdmF0YXIg0LTQvtGB0YLQsNGC0L3RjNC+LFxuICAvLyDRhtC10Lkg0LzQtdGC0L7QtCDQvNC+0LbQvdCwINC90LUg0L/QtdGA0LXQstC40LfQvdCw0YfQsNGC0LggKNCw0LvQtSDRgtC+0LTRliDRgtGA0LXQsdCwINC/0LXRgNC10LTQsNCy0LDRgtC4IGlzVXNlcj1mYWxzZSkuXG4gIC8vINCjINCy0LDRiNC+0LzRgyBCYXNlTWVzc2FnZVJlbmRlcmVyIGBhZGRBdmF0YXJgINC90LUg0ZQg0LDQsdGB0YLRgNCw0LrRgtC90LjQvCwg0YLQvtC80YMg0LnQvtCz0L4g0LzQvtC20L3QsCDQv9GA0L7RgdGC0L4g0LLQuNC60LvQuNC60LDRgtC4LlxuICAvLyDQlNC70Y8g0L/RgNC40LrQu9Cw0LTRgywg0Y/QutGJ0L4gUmVuZGVyZXJVdGlscy5yZW5kZXJBdmF0YXIg0L/RltC00YLRgNC40LzRg9GUINGC0LjQvyAndG9vbCc6XG4gIC8vIHByb3RlY3RlZCBhZGRBdmF0YXIobWVzc2FnZUdyb3VwOiBIVE1MRWxlbWVudCk6IHZvaWQge1xuICAvLyAgIFJlbmRlcmVyVXRpbHMucmVuZGVyQXZhdGFyKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwgbWVzc2FnZUdyb3VwLCBmYWxzZSwgJ3Rvb2wnKTtcbiAgLy8gfVxuICAvLyDQr9C60YnQviDQvdGWLCDRgtC+INCy0LjQutC70LjQuiB0aGlzLmFkZEF2YXRhcihtZXNzYWdlR3JvdXBFbCwgZmFsc2UpOyDQtyByZW5kZXIoKSDQstC40LrQvtGA0LjRgdGC0LDRlCDRgNC10LDQu9GW0LfQsNGG0ZbRjiDQtyBCYXNlTWVzc2FnZVJlbmRlcmVyLlxufSJdfQ==