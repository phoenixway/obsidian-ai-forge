import { __awaiter } from "tslib";
// src/SummaryModal.ts
import { Modal, Setting, Notice } from "obsidian";
export class SummaryModal extends Modal {
    constructor(plugin, title, summary) {
        super(plugin.app); // Передаємо app з плагіна
        this.plugin = plugin; // Зберігаємо плагін
        this.modalTitle = title;
        this.summaryText = summary;
    }
    onOpen() {
        return __awaiter(this, void 0, void 0, function* () {
            const { contentEl } = this;
            contentEl.empty();
            contentEl.createEl("h3", { text: this.modalTitle });
            // Контейнер для тексту сумаризації
            this.summaryContainer = contentEl.createDiv({ cls: "summary-modal-content" });
            this.summaryContainer.setText(this.summaryText);
            // Стилі для контейнера
            this.summaryContainer.style.maxHeight = "60vh";
            this.summaryContainer.style.overflowY = "auto";
            this.summaryContainer.style.whiteSpace = "pre-wrap";
            this.summaryContainer.style.backgroundColor = "var(--background-secondary)";
            this.summaryContainer.style.padding = "10px";
            this.summaryContainer.style.borderRadius = "5px";
            this.summaryContainer.style.border = "1px solid var(--background-modifier-border)";
            this.summaryContainer.style.marginBottom = "15px";
            this.summaryContainer.style.userSelect = "text";
            // Створюємо контейнер для кнопок
            const buttonContainer = new Setting(contentEl)
                .addButton(btn => btn
                .setButtonText("Copy") // Скорочено
                .setTooltip("Copy summary to clipboard")
                .setIcon("copy") // Додаємо іконку
                .onClick(() => {
                navigator.clipboard.writeText(this.summaryText).then(() => {
                    new Notice("Summary copied!");
                }, (err) => {
                    new Notice("Failed to copy summary.");
                    this.plugin.logger.error("Copy summary error:", err);
                });
                // Не закриваємо модалку при копіюванні
                // this.close();
            }));
            // --- ДОДАНО: Кнопка Перекладу ---
            if (this.plugin.settings.enableTranslation && this.plugin.settings.googleTranslationApiKey) {
                buttonContainer.addButton(translateBtn => {
                    translateBtn
                        .setButtonText("Translate")
                        .setTooltip(`Translate to ${this.plugin.settings.translationTargetLanguage}`)
                        .setIcon("languages")
                        .onClick(() => __awaiter(this, void 0, void 0, function* () {
                        const targetLang = this.plugin.settings.translationTargetLanguage;
                        if (!targetLang) {
                            new Notice("Target translation language not set in settings.");
                            return;
                        }
                        // Встановлюємо стан завантаження
                        translateBtn.setButtonText("Translating...");
                        translateBtn.setDisabled(true);
                        translateBtn.setIcon("loader"); // Анімація завантаження
                        try {
                            const translatedSummary = yield this.plugin.translationService.translate(this.summaryText, targetLang);
                            if (translatedSummary !== null) {
                                // Оновлюємо текст в контейнері
                                this.summaryContainer.setText(translatedSummary);
                                // Оновлюємо текст, який копіюється
                                this.summaryText = translatedSummary;
                                new Notice(`Summary translated to ${targetLang}`);
                            }
                            else {
                                // Повідомлення про помилку покаже сам translationService
                            }
                        }
                        catch (error) {
                            this.plugin.logger.error("Error translating summary in modal:", error);
                            new Notice("Translation failed.");
                        }
                        finally {
                            // Відновлюємо кнопку
                            translateBtn.setButtonText("Translate");
                            translateBtn.setDisabled(false);
                            translateBtn.setIcon("languages");
                        }
                    }));
                });
            }
            // --- КІНЕЦЬ ДОДАНОГО ---
            // Кнопка закриття (завжди остання)
            buttonContainer.addButton(btn => btn
                .setButtonText("Close")
                .onClick(() => {
                this.close();
            }));
        });
    }
    onClose() {
        const { contentEl } = this;
        contentEl.empty();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3VtbWFyeU1vZGFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiU3VtbWFyeU1vZGFsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQkFBc0I7QUFDdEIsT0FBTyxFQUFPLEtBQUssRUFBRSxPQUFPLEVBQW1CLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUd4RSxNQUFNLE9BQU8sWUFBYSxTQUFRLEtBQUs7SUFNbkMsWUFBWSxNQUFvQixFQUFFLEtBQWEsRUFBRSxPQUFlO1FBQzVELEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQywwQkFBMEI7UUFDN0MsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxvQkFBb0I7UUFDMUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7SUFDL0IsQ0FBQztJQUVLLE1BQU07O1lBQ1IsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQztZQUMzQixTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7WUFFbEIsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7WUFFcEQsbUNBQW1DO1lBQ25DLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUUsR0FBRyxFQUFFLHVCQUF1QixFQUFFLENBQUMsQ0FBQztZQUM5RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUVoRCx1QkFBdUI7WUFDdkIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO1lBQy9DLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztZQUMvQyxJQUFJLENB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LnRzXG5pbXBvcnQgeyBBcHAsIE1vZGFsLCBTZXR0aW5nLCBCdXR0b25Db21wb25lbnQsIE5vdGljZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE9sbGFtYVBsdWdpbiBmcm9tIFwiLi9tYWluXCI7IC8vINCG0LzQv9C+0YDRgtGD0ZTQvNC+INCz0L7Qu9C+0LLQvdC40Lkg0LrQu9Cw0YEg0L/Qu9Cw0LPRltC90LBcblxuZXhwb3J0IGNsYXNzIFN1bW1hcnlNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBwbHVnaW46IE9sbGFtYVBsdWdpbjsgLy8gPC0tLSDQl9Cx0LXRgNGW0LPQsNGU0LzQviDQtdC60LfQtdC80L/Qu9GP0YAg0L/Qu9Cw0LPRltC90LBcbiAgICBzdW1tYXJ5VGV4dDogc3RyaW5nO1xuICAgIG1vZGFsVGl0bGU6IHN0cmluZztcbiAgICBwcml2YXRlIHN1bW1hcnlDb250YWluZXI6IEhUTUxEaXZFbGVtZW50OyAvLyDQl9Cx0LXRgNGW0LPQsNGU0LzQviDQv9C+0YHQuNC70LDQvdC90Y8g0LTQu9GPINC+0L3QvtCy0LvQtdC90L3Rj1xuXG4gICAgY29uc3RydWN0b3IocGx1Z2luOiBPbGxhbWFQbHVnaW4sIHRpdGxlOiBzdHJpbmcsIHN1bW1hcnk6IHN0cmluZykgeyAvLyA8LS0tINCX0LzRltC90LXQvdC+INC60L7QvdGB0YLRgNGD0LrRgtC+0YBcbiAgICAgICAgc3VwZXIocGx1Z2luLmFwcCk7IC8vINCf0LXRgNC10LTQsNGU0LzQviBhcHAg0Lcg0L/Qu9Cw0LPRltC90LBcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47IC8vINCX0LHQtdGA0ZbQs9Cw0ZTQvNC+INC/0LvQsNCz0ZbQvVxuICAgICAgICB0aGlzLm1vZGFsVGl0bGUgPSB0aXRsZTtcbiAgICAgICAgdGhpcy5zdW1tYXJ5VGV4dCA9IHN1bW1hcnk7XG4gICAgfVxuXG4gICAgYXN5bmMgb25PcGVuKCkgeyAvLyDQl9GA0L7QsdC40LzQviDQsNGB0LjQvdGF0YDQvtC90L3QuNC8INC00LvRjyDQv9C10YDQtdC60LvQsNC00YNcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuXG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImgzXCIsIHsgdGV4dDogdGhpcy5tb2RhbFRpdGxlIH0pO1xuXG4gICAgICAgIC8vINCa0L7QvdGC0LXQudC90LXRgCDQtNC70Y8g0YLQtdC60YHRgtGDINGB0YPQvNCw0YDQuNC30LDRhtGW0ZdcbiAgICAgICAgdGhpcy5zdW1tYXJ5Q29udGFpbmVyID0gY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogXCJzdW1tYXJ5LW1vZGFsLWNvbnRlbnRcIiB9KTtcbiAgICAgICAgdGhpcy5zdW1tYXJ5Q29udGFpbmVyLnNldFRleHQodGhpcy5zdW1tYXJ5VGV4dCk7XG5cbiAgICAgICAgLy8g0KHRgtC40LvRliDQtNC70Y8g0LrQvtC90YLQtdC50L3QtdGA0LBcbiAgICAgICAgdGhpcy5zdW1tYXJ5Q29udGFpbmVyLnN0eWxlLm1heEhlaWdodCA9IFwiNjB2aFwiO1xuICAgICAgICB0aGlzLnN1bW1hcnlDb250YWluZXIuc3R5bGUub3ZlcmZsb3dZID0gXCJhdXRvXCI7XG4gICAgICAgIHRoaXMuc3VtbWFyeUNvbnRhaW5lci5zdHlsZS53aGl0ZVNwYWNlID0gXCJwcmUtd3JhcFwiO1xuICAgICAgICB0aGlzLnN1bW1hcnlDb250YWluZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ2YXIoLS1iYWNrZ3JvdW5kLXNlY29uZGFyeSlcIjtcbiAgICAgICAgdGhpcy5zdW1tYXJ5Q29udGFpbmVyLnN0eWxlLnBhZGRpbmcgPSBcIjEwcHhcIjtcbiAgICAgICAgdGhpcy5zdW1tYXJ5Q29udGFpbmVyLnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNXB4XCI7XG4gICAgICAgIHRoaXMuc3VtbWFyeUNvbnRhaW5lci5zdHlsZS5ib3JkZXIgPSBcIjFweCBzb2xpZCB2YXIoLS1iYWNrZ3JvdW5kLW1vZGlmaWVyLWJvcmRlcilcIjtcbiAgICAgICAgdGhpcy5zdW1tYXJ5Q29udGFpbmVyLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMTVweFwiO1xuICAgICAgICB0aGlzLnN1bW1hcnlDb250YWluZXIuc3R5bGUudXNlclNlbGVjdCA9IFwidGV4dFwiO1xuXG4gICAgICAgIC8vINCh0YLQstC+0YDRjtGU0LzQviDQutC+0L3RgtC10LnQvdC10YAg0LTQu9GPINC60L3QvtC/0L7QulxuICAgICAgICBjb25zdCBidXR0b25Db250YWluZXIgPSBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKGJ0biA9PiBidG5cbiAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkNvcHlcIikgLy8g0KHQutC+0YDQvtGH0LXQvdC+XG4gICAgICAgICAgICAgICAgLnNldFRvb2x0aXAoXCJDb3B5IHN1bW1hcnkgdG8gY2xpcGJvYXJkXCIpXG4gICAgICAgICAgICAgICAgLnNldEljb24oXCJjb3B5XCIpIC8vINCU0L7QtNCw0ZTQvNC+INGW0LrQvtC90LrRg1xuICAgICAgICAgICAgICAgIC5vbkNsaWNrKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodGhpcy5zdW1tYXJ5VGV4dCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiU3VtbWFyeSBjb3BpZWQhXCIpO1xuICAgICAgICAgICAgICAgICAgICB9LCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiRmFpbGVkIHRvIGNvcHkgc3VtbWFyeS5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoXCJDb3B5IHN1bW1hcnkgZXJyb3I6XCIsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyDQndC1INC30LDQutGA0LjQstCw0ZTQvNC+INC80L7QtNCw0LvQutGDINC/0YDQuCDQutC+0L/RltGO0LLQsNC90L3RllxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIC0tLSDQlNCe0JTQkNCd0J46INCa0L3QvtC/0LrQsCDQn9C10YDQtdC60LvQsNC00YMgLS0tXG4gICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVUcmFuc2xhdGlvbiAmJiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5nb29nbGVUcmFuc2xhdGlvbkFwaUtleSkge1xuICAgICAgICAgICAgYnV0dG9uQ29udGFpbmVyLmFkZEJ1dHRvbih0cmFuc2xhdGVCdG4gPT4ge1xuICAgICAgICAgICAgICAgICB0cmFuc2xhdGVCdG5cbiAgICAgICAgICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoXCJUcmFuc2xhdGVcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldFRvb2x0aXAoYFRyYW5zbGF0ZSB0byAke3RoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zbGF0aW9uVGFyZ2V0TGFuZ3VhZ2V9YClcbiAgICAgICAgICAgICAgICAgICAgLnNldEljb24oXCJsYW5ndWFnZXNcIilcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0TGFuZyA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zbGF0aW9uVGFyZ2V0TGFuZ3VhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0YXJnZXRMYW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiVGFyZ2V0IHRyYW5zbGF0aW9uIGxhbmd1YWdlIG5vdCBzZXQgaW4gc2V0dGluZ3MuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCS0YHRgtCw0L3QvtCy0LvRjtGU0LzQviDRgdGC0LDQvSDQt9Cw0LLQsNC90YLQsNC20LXQvdC90Y9cbiAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGVCdG4uc2V0QnV0dG9uVGV4dChcIlRyYW5zbGF0aW5nLi4uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZUJ0bi5zZXREaXNhYmxlZCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGVCdG4uc2V0SWNvbihcImxvYWRlclwiKTsgLy8g0JDQvdGW0LzQsNGG0ZbRjyDQt9Cw0LLQsNC90YLQsNC20LXQvdC90Y9cblxuICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVkU3VtbWFyeSA9IGF3YWl0IHRoaXMucGx1Z2luLnRyYW5zbGF0aW9uU2VydmljZS50cmFuc2xhdGUodGhpcy5zdW1tYXJ5VGV4dCwgdGFyZ2V0TGFuZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJhbnNsYXRlZFN1bW1hcnkgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g0J7QvdC+0LLQu9GO0ZTQvNC+INGC0LXQutGB0YIg0LIg0LrQvtC90YLQtdC50L3QtdGA0ZZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3VtbWFyeUNvbnRhaW5lci5zZXRUZXh0KHRyYW5zbGF0ZWRTdW1tYXJ5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCe0L3QvtCy0LvRjtGU0LzQviDRgtC10LrRgdGCLCDRj9C60LjQuSDQutC+0L/RltGO0ZTRgtGM0YHRj1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdW1tYXJ5VGV4dCA9IHRyYW5zbGF0ZWRTdW1tYXJ5O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgU3VtbWFyeSB0cmFuc2xhdGVkIHRvICR7dGFyZ2V0TGFuZ31gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCf0L7QstGW0LTQvtC80LvQtdC90L3RjyDQv9GA0L4g0L/QvtC80LjQu9C60YMg0L/QvtC60LDQttC1INGB0LDQvCB0cmFuc2xhdGlvblNlcnZpY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKFwiRXJyb3IgdHJhbnNsYXRpbmcgc3VtbWFyeSBpbiBtb2RhbDpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlRyYW5zbGF0aW9uIGZhaWxlZC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vINCS0ZbQtNC90L7QstC70Y7RlNC80L4g0LrQvdC+0L/QutGDXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGVCdG4uc2V0QnV0dG9uVGV4dChcIlRyYW5zbGF0ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0ZUJ0bi5zZXREaXNhYmxlZChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGVCdG4uc2V0SWNvbihcImxhbmd1YWdlc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgIC8vIC0tLSDQmtCG0J3QldCm0Kwg0JTQntCU0JDQndCe0JPQniAtLS1cblxuXG4gICAgICAgIC8vINCa0L3QvtC/0LrQsCDQt9Cw0LrRgNC40YLRgtGPICjQt9Cw0LLQttC00Lgg0L7RgdGC0LDQvdC90Y8pXG4gICAgICAgIGJ1dHRvbkNvbnRhaW5lci5hZGRCdXR0b24oYnRuID0+IGJ0blxuICAgICAgICAgICAgLnNldEJ1dHRvblRleHQoXCJDbG9zZVwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBvbkNsb3NlKCkge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgfVxufSJdfQ==