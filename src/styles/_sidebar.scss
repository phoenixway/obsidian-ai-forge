$indent-step: 16px;
$item-padding-vertical: var(--size-4-1);
$item-padding-horizontal: var(--size-4-2, 8px); // Базовий горизонтальний відступ з fallback
$icon-size: 16px;
$icon-margin: var(--size-4-2);
$folder-icon-extra-indent: 4px;

// --- Sidebar Accordion Sections ---
.ollama-chat-panel,
.ollama-role-panel {
  display: flex;
  flex-direction: column;
  min-height: 0; // Критично для поведінки flex в обмеженому просторі
  position: relative; // Для позиціонування дочірніх елементів
  
  // Загальні правила для обох панелей
  .ollama-sidebar-section-header {
    flex: 0 0 auto; // Фіксована висота заголовка
  }
  
  // Оптимізована панель ролей
  &.ollama-role-panel {
    flex: 0 0 auto; // Початково компактна
    transition: flex 0.3s ease-out; // Плавна зміна розміру
    margin-bottom: var(--size-4-2);
    
    // Коли розгорнута і має контент - займає потрібний простір
    &.is-expanded {
      flex: 0 1 auto; // Може стискатись при потребі, але не розтягується
      max-height: 40%; // Максимальна висота 40% від контейнера
      
      // Якщо панель чатів не розгорнута, займаємо весь доступний простір
      .ollama-chat-panel:not(.is-expanded) + & {
        flex: 1 1 auto;
      }
    }
    
    // Коли не розгорнута - показуємо тільки заголовок
    &:not(.is-expanded) .ollama-sidebar-section-content {
      max-height: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      opacity: 0 !important;
      visibility: hidden !important;
    }
  }
  
  // Оптимізована панель чатів
  &.ollama-chat-panel {
    flex: 1 1 auto; // Займає весь доступний простір
    min-height: 0; // Важливо для скролінгу
    overflow: hidden; // Запобігає переповненню
    
    // Коли не розгорнута - компактна
    &:not(.is-expanded) {
      flex: 0 0 auto;
      
      .ollama-sidebar-section-content {
        max-height: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        opacity: 0 !important;
        visibility: hidden !important;
      }
    }
    
    // Коли розгорнута - займає доступний простір
    &.is-expanded {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      
      // Якщо обидві панелі розгорнуті, обмежуємо висоту чатів
      .ollama-role-panel.is-expanded + & {
        flex: 1 1 60%; // Віддаємо перевагу чатам (60%)
      }
      
      .ollama-sidebar-section-content {
        flex: 1 1 auto;
        min-height: 0;
        overflow-y: auto;
        
        .ollama-hierarchy-item {
          // Переконуємось, що елементи чатів мають правильні відступи
          &.ollama-chat-item .ollama-hierarchy-item-content {
            padding-right: $item-padding-horizontal;
          }
        }
      }
    }
  }
}

// Модифікація стилю контенту секції для кращої адаптивності
.ollama-sidebar-section-content {
  &.is-expanded {
    flex: 1 1 auto !important; // Пріоритет на розтягування
    display: flex;
    flex-direction: column;
    min-height: 0; // Критично для flex та скролінгу
    
    // Контейнери списків повинні розтягуватись
    .ollama-role-panel-list,
    .ollama-hierarchy-item-children {
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;
    }
  }
}

// Додатковий сценарій для випадку, коли обидві панелі розгорнуті
.ollama-sidebar-container {
  &:has(.ollama-chat-panel.is-expanded):has(.ollama-role-panel.is-expanded) {
    .ollama-chat-panel.is-expanded {
      flex: 3; // 75% для чатів
    }
    .ollama-role-panel.is-expanded {
      flex: 1; // 25% для ролей
    }
  }
}