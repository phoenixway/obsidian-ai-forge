// src/styles/_layout.scss
// Wednesday, April 23, 2025

// Main View Container
.ollama-container {
    display: flex;
    flex-direction: row; // Горизонтальний макет: панель + чат
    height: 100%;
    background-color: var(--background-secondary-alt);
    align-items: stretch; // Розтягнути по висоті
    gap: 0;
    overflow: hidden; // Головний контейнер обрізає все, що виходить за межі
}

// --- Sidebar Panel (Hosts Accordion) ---
.ollama-role-panel {
    display: flex;
    flex-direction: column;
    width: 240px;
    flex-shrink: 0;
    background-color: var(--background-secondary);
    border-right: 1px solid var(--divider-color);
    height: 100%;
    // overflow: hidden; // <-- ЗМІНЕНО: Прибираємо hidden
    overflow-y: auto; // <-- ДОДАНО: Дозволяємо вертикальний скрол для ВСІЄЇ панелі
    overflow-x: hidden; // Забороняємо горизонтальний скрол
    box-sizing: border-box;

    // --- ДОДАНО: Стилі скролбару для самої панелі ---
    &::-webkit-scrollbar { width: 6px; }
    &::-webkit-scrollbar-track { background: transparent; margin: 2px 0; } // Тонший трек
    &::-webkit-scrollbar-thumb { background-color: var(--background-modifier-border); border-radius: 3px; }
    &::-webkit-scrollbar-thumb:hover { background-color: var(--interactive-accent-translucent); }
    // --- КІНЕЦЬ СТИЛІВ СКРОЛБАРУ ---
}

// --- Sidebar Accordion Sections ---

.ollama-role-panel {
    display: flex;
    flex-direction: column;
    width: 240px;
    flex-shrink: 0;
    background-color: var(--background-secondary);
    border-right: 1px solid var(--divider-color);
    height: 100%;
    overflow: hidden; // Keep this
    box-sizing: border-box;
}

// --- Sidebar Accordion Sections ---

// Header for collapsible sections (Chats, Roles)
.ollama-sidebar-section-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: calc(var(--chat-spacing-unit) * 2) calc(var(--chat-spacing-unit) * 1.5)
               calc(var(--chat-spacing-unit) * 2) calc(var(--chat-spacing-unit) * 2.5);
    user-select: none;
    cursor: pointer;
    flex-shrink: 0; // Важливо, щоб заголовки не стискались
    position: relative;
    border-radius: var(--radius-s);
    margin: 1px 0;
    &:hover { background-color: var(--background-modifier-hover); }

    // Ліва частина заголовка (іконка + текст)
    .ollama-sidebar-header-left {
        display: flex;
        align-items: baseline;
        overflow: hidden;
        // Займає простір, але дозволяє кнопці справа бути видимою
        // flex-grow: 1; // Можливо, не потрібно, якщо кнопка не росте
        margin-right: var(--chat-spacing-unit); // Відступ від кнопки "+"
    }

    .ollama-sidebar-section-icon { /* як було */
        margin-right: 14px;
        min-width: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        .svg-icon { width: 16px; height: 16px; color: var(--text-faint); }
    }
    &:hover .ollama-sidebar-section-icon .svg-icon { color: var(--text-muted); }

    .menu-option-text { /* як було */
        font-weight: 500;
        color: var(--text-normal);
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    // Кнопка "+"
    .ollama-sidebar-header-button {
        padding: 2px;
        margin-left: auto; // Притискає до правого краю, якщо місця достатньо
        flex-shrink: 0;
        color: var(--text-muted);
        opacity: 0.7;
        // Прибираємо фон і рамку, щоб була лише іконка
        background: none;
        border: none;
        box-shadow: none;

        &:hover {
            color: var(--text-normal);
            opacity: 1;
            background-color: var(--background-modifier-hover);
        }
        .svg-icon { width: 18px; height: 18px; }
    }
}

// Контент акордеону
.ollama-sidebar-section-content { /* як було */
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    box-sizing: border-box;
    padding: 0 calc(var(--chat-spacing-unit) * 1.5);
    min-height: 0;
    flex-shrink: 0;

    &.is-expanded {
        // max-height: 75vh;
        // overflow-y: auto;
        padding-top: calc(var(--chat-spacing-unit) * 1);
        padding-bottom: calc(var(--chat-spacing-unit) * 1);
        max-height: 10000px;
        overflow-y: hidden
    }
    // ... scrollbar, etc. ...
     &::-webkit-scrollbar { width: 6px; }
    &::-webkit-scrollbar-track { background: transparent; margin: 2px 0; }
    &::-webkit-scrollbar-thumb { background-color: var(--background-modifier-border); border-radius: 3px; }
    &::-webkit-scrollbar-thumb:hover { background-color: var(--interactive-accent-translucent); }
     .menu-info-text {
        padding: calc(var(--chat-spacing-unit) * 1.8) calc(var(--chat-spacing-unit) * 1);
        color: var(--text-faint);
        font-style: italic;
        font-size: calc(var(--font-ui-small) * 0.9);
    }
     hr.menu-separator {
        margin: calc(var(--chat-spacing-unit) * 1.5) 0;
        border: none;
        border-top: 1px solid var(--background-modifier-border);
        flex-shrink: 0;
    }
}

// --- ЗМІНА: Стилі для елемента списку чатів ---
.ollama-chat-panel-item {
    &.menu-option {
        display: flex;
        align-items: center; // Вирівнюємо іконку, текст і кнопку по вертикалі
        padding: calc(var(--chat-spacing-unit) * 1.5) // Зменшено вертикальний паддінг
                 calc(var(--chat-spacing-unit) * 1.5); // Зменшено горизонтальний паддінг
        margin: 1px 0;

        // Іконка зліва (як була)
        .menu-option-icon {
            margin-right: 10px;
            min-width: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            .svg-icon { width: 15px; height: 15px; }
        }

        // Обгортка для тексту (Назва + Дата) - займає простір
        .ollama-chat-item-text-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1; // Займає доступний простір
            overflow: hidden; // Обрізати довгий текст
            margin-right: 8px; // Відступ перед кнопкою "..."
            line-height: 1.3;
            gap: 1px;

             .chat-panel-item-name {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-size: calc(var(--font-ui-small) * 0.95);
            }
            .chat-panel-item-date {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-size: 0.85em;
                color: var(--text-faint);
            }
        }

        // Кнопка "..." (Опції) - справа
        .ollama-chat-item-options {
            padding: 3px;
            margin: -3px; // Компенсація паддінгу для зони кліку
            flex-shrink: 0; // Не стискати
            opacity: 0; // --- Прихована за замовчуванням ---
            transition: opacity 0.15s ease-in-out; // Плавна поява
            border-radius: var(--radius-s);
            background: none;
            border: none;
            color: var(--text-muted); // Колір іконки

            &:hover {
                background-color: var(--background-modifier-hover);
                color: var(--text-normal); // Колір іконки при наведенні
            }
            .svg-icon { width: 18px; height: 18px; }
        }

        // Показуємо кнопку "..." при наведенні на весь елемент списку
        &:hover .ollama-chat-item-options {
             opacity: 0.7; // Робимо видимою при наведенні
             &:hover { opacity: 1; } // Повна непрозорість при наведенні на саму кнопку
        }

         // Активний стан
         &.is-active {
            background-color: var(--interactive-accent-translucent);
            .menu-option-icon { color: var(--interactive-accent); }
            .chat-panel-item-name { color: var(--text-accent-hover); font-weight: 500;}
            .chat-panel-item-date { color: var(--text-accent-hover); opacity: 0.8;}
             // Можна зробити кнопку опцій видимою постійно для активного елемента
            // .ollama-chat-item-options { opacity: 0.7; }
            &:hover { background-color: var(--interactive-accent-translucent); filter: brightness(1.1); }
         }
    }
}

// Content area for collapsible sections
.ollama-sidebar-section-content {
    overflow: hidden;
    max-height: 0; // Collapsed by default
    transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    box-sizing: border-box;
    padding: 0 calc(var(--chat-spacing-unit) * 1.5); // Horizontal padding only when collapsed
    // min-height: 0; // Not strictly needed if not a flex item that needs shrinking
    // flex-shrink: 0; // Not needed if not using flex-grow

    // Expanded state
    &.is-expanded {
        // flex-grow: 1; // <-- REMOVE THIS LINE
        // flex-shrink: 1; // <-- REMOVE THIS LINE
        max-height: 75vh; // Keep max-height limit (adjust value as needed)
        overflow-y: auto; // Enable scrolling
        padding-top: calc(var(--chat-spacing-unit) * 1);
        padding-bottom: calc(var(--chat-spacing-unit) * 1);
    }

    // Scrollbar styling
    &::-webkit-scrollbar { width: 6px; }
    &::-webkit-scrollbar-track { background: transparent; margin: 2px 0; }
    &::-webkit-scrollbar-thumb { background-color: var(--background-modifier-border); border-radius: 3px; }
    &::-webkit-scrollbar-thumb:hover { background-color: var(--interactive-accent-translucent); }

    // --- Styles for elements INSIDE the content lists ---
    // (List items, chat item layout, empty text, separator - keep as before)
     .ollama-role-panel-item,
    .ollama-chat-panel-item {
        &.menu-option {
            display: flex;
            align-items: center;
            padding: calc(var(--chat-spacing-unit) * 1.8)
                     calc(var(--chat-spacing-unit) * 1.5);
            margin: 1px 0;
            cursor: pointer;
            border-radius: var(--radius-s);

            &:hover {
                background-color: var(--background-modifier-hover);
            }

            .menu-option-icon {
                margin-right: 10px;
                min-width: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
                .svg-icon { width: 15px; height: 15px; }
            }

            .menu-option-text {
                font-size: calc(var(--font-ui-small) * 0.95);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex-grow: 1;
            }

            &.is-active {
                background-color: var(--interactive-accent-translucent);
                color: var(--text-accent-hover);
                .menu-option-text, .chat-panel-item-name {
                  font-weight: 500;
                  color: var(--text-accent-hover);
                }
                .chat-panel-item-date {
                   color: var(--text-accent-hover);
                   opacity: 0.8;
                }
                .menu-option-icon { color: var(--interactive-accent); }
                &:hover { background-color: var(--interactive-accent-translucent); filter: brightness(1.1); }
            }
            &.is-custom .menu-option-icon:not(:has(.svg-icon[icon-name="check"])) {
                color: var(--text-faint);
            }
        }
    }
     .ollama-chat-panel-item {
       &.menu-option {
           .menu-option-text {
                display: flex;
                flex-direction: column;
                line-height: 1.3;
                gap: 1px;
           }
           .chat-panel-item-name {
           }
           .chat-panel-item-date {
                font-size: 0.85em;
                color: var(--text-faint);
           }
           &.is-active {
              .chat-panel-item-date {
                  color: var(--text-accent-hover);
                  opacity: 0.8;
              }
           }
       }
    }
     .menu-info-text {
        padding: calc(var(--chat-spacing-unit) * 1.8) calc(var(--chat-spacing-unit) * 1);
        color: var(--text-faint);
        font-style: italic;
        font-size: calc(var(--font-ui-small) * 0.9);
    }
     hr.menu-separator {
        margin: calc(var(--chat-spacing-unit) * 1.5) 0;
        border-top-color: var(--background-modifier-border);
    }
}
// --- End Sidebar Accordion Sections ---

// --- Main Chat Area (Messages + Input) --- (No changes needed here)
.ollama-main-chat-area {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    height: 100%;
    min-width: 0;
    overflow: hidden;
}
.ollama-chat-area-content {
    flex-grow: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}
.ollama-chat-container {
    flex-grow: 1;
    max-width: none;
    margin-left: 0;
    margin-right: 0;
    padding: calc(var(--chat-spacing-unit) * 4);
    overflow-y: auto;
    min-height: 0;

    &::-webkit-scrollbar { width: 8px; }
    &::-webkit-scrollbar-track { background: var(--background-secondary); border-radius: 4px; margin: 4px 0; }
    &::-webkit-scrollbar-thumb { background-color: var(--background-modifier-border); border-radius: 4px; border: 2px solid var(--background-secondary); }
    &::-webkit-scrollbar-thumb:hover { background-color: var(--interactive-accent-translucent); }
}
.chat-input-container {
    flex-shrink: 0;
    width: 100%;
}
// --- End Main Chat Area ---


// --- RESPONSIVE --- (No changes needed here)
@media screen and (max-width: 768px) {
    .ollama-container {
        flex-direction: column;
        overflow: visible;
    }
    .ollama-role-panel {
        display: none; // Hides the entire sidebar including accordion
        width: 100%;
        height: auto;
        border-right: none;
    }
    .ollama-main-chat-area {
        height: 100%;
        border-left: none;
        overflow: visible;
    }
    .chat-input-container {
         margin-top: 10px;
    }
}
// --- END RESPONSIVE ---


// --- User Select Fix --- (No changes needed here)
.ollama-container .message .message-content {
    user-select: text !important;
    pre, code {
      user-select: text !important;
    }
  }
.ollama-container .user-message .message-content {
     user-select: text !important;
}