// OllamaService.ts
import { __asyncGenerator, __await, __awaiter } from "tslib";
export class OllamaService {
    constructor(plugin) {
        this.eventHandlers = {};
        this.plugin = plugin;
        if (!plugin.promptService) {
            const errorMsg = "[OllamaService] CRITICAL: PromptService not available on plugin instance during OllamaService construction!";
            this.plugin.logger.error(errorMsg); // Використовуємо логер плагіна
            throw new Error(errorMsg);
        }
        this.promptService = plugin.promptService;
        this.logger = plugin.logger; // Використовуємо логер плагіна
    }
    // --- Event Emitter (залишаємо без змін) ---
    on(event, callback) {
        if (!this.eventHandlers[event])
            this.eventHandlers[event] = [];
        this.eventHandlers[event].push(callback);
        return () => {
            var _a, _b;
            this.eventHandlers[event] = (_a = this.eventHandlers[event]) === null || _a === void 0 ? void 0 : _a.filter(h => h !== callback);
            if (((_b = this.eventHandlers[event]) === null || _b === void 0 ? void 0 : _b.length) === 0)
                delete this.eventHandlers[event];
        };
    }
    emit(event, data) {
        const h = this.eventHandlers[event];
        if (h)
            h.slice().forEach(handler => { try {
                handler(data);
            }
            catch (e) {
                this.plugin.logger.error(`Error in OllamaService event handler for ${event}:`, e);
            } });
    }
    // ------------------------------------------
    /**
    * Відправляє запит на генерацію відповіді Ollama і повертає асинхронний ітератор для отримання частин відповіді.
    * @param chat Поточний об'єкт чату.
    * @param signal AbortSignal для можливості переривання запиту.
    * @returns Асинхронний ітератор, що видає StreamChunk.
    */
    generateChatResponseStream(chat, // Залишаємо chat, оскільки PromptService потребує ChatMetadata
    signal) {
        return __asyncGenerator(this, arguments, function* generateChatResponseStream_1() {
            var _a, _b, _c, _d, _e, _f;
            const requestTimestampId = Date.now(); // Для логування
            this.logger.debug(`[OllamaService][id:${requestTimestampId}] generateChatResponseStream initiated for chat ${chat.metadata.id}`);
            if (!chat) {
                this.plugin.logger.error("[OllamaService] generateChatResponseStream called with null chat object.");
                yield yield __await({ type: 'error', error: "Chat object is null.", done: true });
                return yield __await(void 0);
            }
            if (!this.promptService) {
                this.plugin.logger.error("[OllamaService] PromptService is unavailable.");
                yield yield __await({ type: 'error', error: "Prompt service is unavailable.", done: true });
                return yield __await(void 0);
            }
            const currentSettings = this.plugin.settings;
            const modelName = chat.metadata.modelName || currentSettings.modelName; // Модель з метаданих чату або дефолтна
            const temperature = (_a = chat.metadata.temperature) !== null && _a !== void 0 ? _a : currentSettings.temperature; // Температура з метаданих або дефолтна
            if (!modelName) {
                this.plugin.logger.error("[OllamaService] No Ollama model selected for chat.", chat.metadata);
                yield yield __await({ type: 'error', error: "No Ollama model selected.", done: true });
                return yield __await(void 0);
            }
            const url = `${this.plugin.settings.ollamaServerUrl}/api/generate`;
            const headers = { 'Content-Type': 'application/json' };
            try {
                const history = chat.getMessages(); // Отримуємо історію з об'єкта Chat
                const systemPrompt = yield __await(this.promptService.getSystemPromptForAPI(chat.metadata));
                const promptBody = yield __await(this.promptService.preparePromptBody(history, chat.metadata));
                if (promptBody === null || promptBody === undefined) {
                    this.plugin.logger.error("[OllamaService] Could not generate prompt body for chat.", chat.metadata);
                    yield yield __await({ type: 'error', error: "Could not generate prompt body.", done: true });
                    return yield __await(void 0);
                }
                const requestBody = Object.assign({ model: modelName, prompt: promptBody, stream: true, temperature: temperature, options: { num_ctx: currentSettings.contextWindow } }, (systemPrompt && { system: systemPrompt }));
                if (this.plugin.agentManager && this.plugin.settings.enableToolUse) {
                    const agentTools = this.plugin.agentManager.getAllToolDefinitions();
                    if (agentTools && agentTools.length > 0) {
                        // Перевірка, чи модель може підтримувати інструменти (дуже приблизна)
                        // Краще мати список моделей, що підтримують інструменти, або перевіряти можливості моделі іншим шляхом
                        const modelDetails = yield __await(this.getModelDetails(modelName));
                        const seemsToSupportTools = ((_c = (_b = modelDetails === null || modelDetails === void 0 ? void 0 : modelDetails.details) === null || _b === void 0 ? void 0 : _b.family) === null || _c === void 0 ? void 0 : _c.toLowerCase().includes("llama3")) ||
                            ((_e = (_d = modelDetails === null || modelDetails === void 0 ? void 0 : modelDetails.details) === null || _d === void 0 ? void 0 : _d.family) === null || _e === void 0 ? void 0 : _e.toLowerCase().includes("mistral")) || // Додайте інші відомі сім'ї
                            (((_f = modelDetails === null || modelDetails === void 0 ? void 0 : modelDetails.details) === null || _f === void 0 ? void 0 : _f.parameter_size) && parseFloat(modelDetails.details.parameter_size.replace('B', '')) >= 7);
                        if (seemsToSupportTools) {
                            requestBody.tools = agentTools.map(tool => ({ type: "function", function: tool }));
                            this.plugin.logger.info(`[OllamaService] Tools provided to Ollama for model ${modelName}:`, agentTools.map(t => t.name));
                            // requestBody.format = 'json'; // Розкоментуйте, якщо модель цього вимагає для tool_calls. ОБЕРЕЖНО!
                        }
                        else {
                            this.plugin.logger.info(`[OllamaService] Model ${modelName} might not natively support tool calling (or check failed). Tools not explicitly sent via 'tools' parameter. Relying on prompt-based fallback if implemented.`);
                            // Тут може бути логіка для додавання інструкцій для fallback-механізму в systemPrompt або promptBody,
                            // якщо ви вирішите його реалізувати.
                        }
                    }
                }
                this.plugin.logger.debug(`[OllamaService] Sending request to ${url} for model ${modelName}. System prompt length: ${(systemPrompt === null || systemPrompt === void 0 ? void 0 : systemPrompt.length) || 0}, Body prompt length: ${promptBody.length}`);
                // this.plugin.logger.debug(`[OllamaService] Request body: ${JSON.stringify(requestBody, null, 2)}`);
                this.logger.debug(`[OllamaService][id:${requestTimestampId}] Sending request to ${url} for model ${modelName}. Prompt length: ${promptBody.length}. System part length: ${(systemPrompt === null || systemPrompt === void 0 ? void 0 : systemPrompt.length) || 0}`);
                this.logger.trace(`[OllamaService][id:${requestTimestampId}] Request body:`, requestBody);
                const response = yield __await(fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestBody),
                    signal: signal
                }));
                if (!response.ok) {
                    let errorText = `Ollama API error! Status: ${response.status}`;
                    try {
                        const errorJson = yield __await(response.json());
                        errorText += `: ${(errorJson === null || errorJson === void 0 ? void 0 : errorJson.error) || response.statusText || 'No details'}`;
                    }
                    catch (e) {
                        errorText += `: ${response.statusText || 'Could not parse error details'}`;
                    }
                    this.plugin.logger.error(`[OllamaService] API Error: ${errorText}`, requestBody);
                    this.emit('connection-error', new Error(errorText));
                    yield yield __await({ type: 'error', error: errorText, done: true });
                    return yield __await(void 0);
                }
                if (!response.body) {
                    this.plugin.logger.error("[OllamaService] Response body is null.");
                    yield yield __await({ type: 'error', error: "Response body is null.", done: true });
                    return yield __await(void 0);
                }
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';
                let rawResponseAccumulator = "";
                while (true) {
                    const { done, value } = yield __await(reader.read());
                    if (signal === null || signal === void 0 ? void 0 : signal.aborted) {
                        this.plugin.logger.info("[OllamaService] Stream generation aborted by user signal.");
                        reader.cancel("Aborted by user");
                        yield yield __await({ type: 'error', error: "Generation aborted by user.", done: true });
                        return yield __await(void 0);
                    }
                    const decodedChunk = decoder.decode(value, { stream: !done });
                    // --- ЛОГУВАННЯ СИРОГО ПОТОКУ ---
                    rawResponseAccumulator += decodedChunk;
                    if (done) {
                        this.plugin.logger.info("[OllamaService] Stream reader marked as done.");
                        this.logger.debug(`[OllamaService][id:${requestTimestampId}] Stream reader 'done'. Final raw buffer: "${buffer}${decodedChunk}"`);
                        // --- ЛОГУВАННЯ ПОВНОЇ СИРОЇ ВІДПОВІДІ ---
                        this.logger.debug(`[OllamaService][id:${requestTimestampId}] === RAW FULL STREAM RESPONSE (from OllamaService) START ===`);
                        this.logger.debug(rawResponseAccumulator);
                        this.logger.debug(`[OllamaService][id:${requestTimestampId}] === RAW FULL STREAM RESPONSE (from OllamaService) END === Length: ${rawResponseAccumulator.length}`);
                        buffer += decodedChunk; //CHECKIT
                        // -------------------------------------------
                        // Обробка залишку буфера, якщо він не порожній і є валідним JSON
                        if (buffer.trim()) {
                            try {
                                const jsonChunk = JSON.parse(buffer.trim());
                                // Це малоймовірно, але якщо останній чанк був не `done:true`
                                if (jsonChunk.message && jsonChunk.message.tool_calls && jsonChunk.message.tool_calls.length > 0) {
                                    yield yield __await({ type: 'tool_calls', calls: jsonChunk.message.tool_calls, assistant_message_with_calls: jsonChunk.message, model: jsonChunk.model, created_at: jsonChunk.created_at });
                                }
                                else if (typeof jsonChunk.response === 'string') {
                                    yield yield __await({ type: 'content', response: jsonChunk.response, done: jsonChunk.done || false, model: jsonChunk.model, created_at: jsonChunk.created_at });
                                }
                                else if (jsonChunk.error) {
                                    yield yield __await({ type: 'error', error: jsonChunk.error, done: true });
                                }
                                // Якщо тут `done:true`, то це вже мало бути оброблено в циклі нижче
                            }
                            catch (e) {
                                this.plugin.logger.warn(`[OllamaService] Failed to parse final buffer content: "${buffer.trim()}". Error: ${e.message}`);
                            }
                        }
                        break; // Вихід з циклу, коли потік завершено
                    }
                    buffer += decoder.decode(value, { stream: true });
                    let eolIndex;
                    while ((eolIndex = buffer.indexOf('\n')) >= 0) {
                        const line = buffer.substring(0, eolIndex).trim();
                        buffer = buffer.substring(eolIndex + 1);
                        if (line === '')
                            continue;
                        try {
                            const jsonChunk = JSON.parse(line);
                            this.plugin.logger.debug('[OllamaService] Raw chunk received:', JSON.stringify(jsonChunk));
                            if (jsonChunk.error) {
                                this.plugin.logger.error(`[OllamaService] Error chunk from Ollama: ${jsonChunk.error}`);
                                yield yield __await({ type: 'error', error: jsonChunk.error, done: true });
                                reader.cancel("Error received from Ollama stream");
                                return yield __await(void 0); // Важливо вийти, якщо Ollama повернула помилку
                            }
                            // Пріоритет для tool_calls
                            if (jsonChunk.message && jsonChunk.message.tool_calls && jsonChunk.message.tool_calls.length > 0) {
                                this.plugin.logger.error('[OllamaService] Raw tool_calls content:', JSON.stringify(jsonChunk.message.tool_calls, null, 2));
                                this.plugin.logger.info('[OllamaService] Yielding tool_calls chunk:', jsonChunk.message.tool_calls);
                                yield yield __await({
                                    type: 'tool_calls',
                                    calls: jsonChunk.message.tool_calls,
                                    assistant_message_with_calls: jsonChunk.message,
                                    model: jsonChunk.model,
                                    created_at: jsonChunk.created_at
                                });
                                // Після tool_calls модель зазвичай чекає на відповідь, тому done може бути false.
                                // Якщо done тут true, це означає, що модель не чекає і завершує хід.
                                if (jsonChunk.done === true) {
                                    this.plugin.logger.info('[OllamaService] Stream finished (done:true received with tool_calls chunk).');
                                    yield yield __await({
                                        type: 'done',
                                        model: jsonChunk.model,
                                        created_at: jsonChunk.created_at,
                                        context: jsonChunk.context, // та інші метрики, якщо є
                                        total_duration: jsonChunk.total_duration,
                                        load_duration: jsonChunk.load_duration,
                                        prompt_eval_count: jsonChunk.prompt_eval_count,
                                        prompt_eval_duration: jsonChunk.prompt_eval_duration,
                                        eval_count: jsonChunk.eval_count,
                                        eval_duration: jsonChunk.eval_duration
                                    });
                                    this.logger.debug(`[OllamaService][id:${requestTimestampId}] === RAW FULL STREAM RESPONSE (from OllamaService after final done) START ===`);
                                    this.logger.debug(rawResponseAccumulator);
                                    this.logger.debug(`[OllamaService][id:${requestTimestampId}] === RAW FULL STREAM RESPONSE (from OllamaService after final done) END === Length: ${rawResponseAccumulator.length}`);
                                    // -------------------------------------------
                                    return yield __await(void 0);
                                }
                            }
                            else if (typeof jsonChunk.response === 'string') { // Текстовий контент
                                this.plugin.logger.debug('[OllamaService] Yielding content chunk.');
                                this.plugin.logger.error('[OllamaService] mes:', jsonChunk.message);
                                this.plugin.logger.debug('[OllamaService] Raw content chunk:', jsonChunk.response);
                                this.plugin.logger.debug('[OllamaService] Raw content chunk (stringify):', JSON.stringify(jsonChunk.response, null, 2));
                                this.plugin.logger.debug('[OllamaService] Raw content chunk (stringify):', jsonChunk);
                                yield yield __await({
                                    type: 'content',
                                    response: jsonChunk.response,
                                    done: jsonChunk.done || false, // done може бути true тут, якщо це останній текстовий чанк
                                    model: jsonChunk.model,
                                    created_at: jsonChunk.created_at
                                });
                                if (jsonChunk.done === true) { // Якщо це останній текстовий чанк і done=true
                                    this.plugin.logger.info('[OllamaService] Stream finished (done:true received with content chunk).');
                                    this.plugin.logger.error('[OllamaService] Final chunk with metrics:', jsonChunk);
                                    // Не відправляємо окремий 'done' чанк, бо інформація вже в цьому.
                                    // Однак, фінальний 'done' чанк від Ollama зазвичай містить більше метрик.
                                    // Якщо це не фінальний чанк з метриками, тоді очікуємо його.
                                    // Якщо `jsonChunk` вже містить всі метрики, то можна повернути його як `done`
                                    // Але зазвичай є окремий фінальний чанк лише з `done:true` та метриками.
                                }
                            }
                            else if (jsonChunk.done === true) { // Фінальний чанк "done" з метриками
                                this.plugin.logger.info('[OllamaService] Stream finished (final done:true chunk with metrics).');
                                this.plugin.logger.error('[OllamaService] mes:', jsonChunk.message);
                                yield yield __await({
                                    type: 'done',
                                    model: jsonChunk.model,
                                    created_at: jsonChunk.created_at,
                                    context: jsonChunk.context,
                                    total_duration: jsonChunk.total_duration,
                                    load_duration: jsonChunk.load_duration,
                                    prompt_eval_count: jsonChunk.prompt_eval_count,
                                    prompt_eval_duration: jsonChunk.prompt_eval_duration,
                                    eval_count: jsonChunk.eval_count,
                                    eval_duration: jsonChunk.eval_duration
                                });
                                return yield __await(void 0); // Завершуємо генератор
                            }
                            else if (jsonChunk.message && (jsonChunk.message.content === null || jsonChunk.message.content === "") && !jsonChunk.message.tool_calls) {
                                // Це може бути порожнє повідомлення асистента (напр., перед tool_calls або при завершенні)
                                // Якщо done false, ігноруємо його, чекаємо на корисні дані або done:true.
                                // this.plugin.logger.debug('[OllamaService] Received empty assistant message shell, ignoring.');
                            }
                            // else {
                            //   this.plugin.logger.warn('[OllamaService] Unhandled or unexpected chunk structure:', jsonChunk);
                            // }
                        }
                        catch (e) {
                            this.plugin.logger.warn(`[OllamaService] Failed to parse JSON chunk: "${line}". Error: ${e.message}. Skipping chunk.`);
                            // Не кидаємо помилку, щоб не перервати весь потік через один пошкоджений чанк,
                            // але логуємо її.
                        }
                    } // кінець while ((eolIndex = buffer.indexOf('\n')) >= 0)
                } // кінець while (true)
            }
            catch (error) {
                if (error.name === 'AbortError') {
                    this.plugin.logger.info("[OllamaService] Stream generation aborted by user (caught AbortError).");
                    yield yield __await({ type: 'error', error: "Generation aborted by user.", done: true });
                }
                else {
                    let errorMessage = error instanceof Error ? error.message : "Unknown error generating stream.";
                    if (errorMessage.includes("connect") || errorMessage.includes("fetch") || errorMessage.includes("NetworkError") || errorMessage.includes('Failed to fetch')) {
                        errorMessage = `Connection Error: Failed to reach Ollama at ${this.plugin.settings.ollamaServerUrl}. Is it running?`;
                        this.emit('connection-error', new Error(errorMessage));
                    }
                    this.plugin.logger.error(`[OllamaService] Error during stream generation: ${errorMessage}`, error);
                    yield yield __await({ type: 'error', error: errorMessage, done: true });
                }
            }
            finally {
                this.plugin.logger.info("[OllamaService] generateChatResponseStream finished or terminated.");
            }
        });
    }
    // ... (інші ваші методи: generateRaw, generateEmbeddings, getModels, getModelDetails) ...
    // Переконайтеся, що вони адаптовані для використання this.plugin.logger замість console.error/log
    // і this.emit('connection-error', ...) для помилок з'єднання.
    generateRaw(requestBody) {
        return __awaiter(this, void 0, void 0, function* () {
            var _a;
            if (!requestBody.model || !requestBody.prompt) {
                this.plugin.logger.error("[OllamaService] generateRaw called without 'model' or 'prompt'.");
                throw new Error("generateRaw requires 'model' and 'prompt' in requestBody");
            }
            requestBody.stream = false;
            if (!requestBody.system) {
                delete requestBody.system;
            }
            const url = `${this.plugin.settings.ollamaServerUrl}/api/generate`;
            const headers = { 'Content-Type': 'application/json' };
            try {
                const response = yield fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestBody)
                });
                if (!response.ok) {
                    let errorText = `Ollama API error (generateRaw)! Status: ${response.status}`;
                    try {
                        const errorJson = yield response.json();
                        errorText += `: ${(errorJson === null || errorJson === void 0 ? void 0 : errorJson.error) || response.statusText || 'No details'}`;
                    }
                    catch (e) {
                        errorText += `: ${response.statusText || 'Could not parse error details'}`;
                    }
                    this.plugin.logger.error(`[OllamaService] API Error (generateRaw): ${errorText}`, requestBody);
                    this.emit('connection-error', new Error(errorText));
                    throw new Error(errorText);
                }
                if (!response.body) {
                    this.plugin.logger.error("[OllamaService] Response body is null (generateRaw).");
                    throw new Error("Response body is null (generateRaw)");
                }
                return yield response.json();
            }
            catch (error) {
                const connectionErrorMsg = `Failed to connect/communicate with Ollama server at ${this.plugin.settings.ollamaServerUrl}. Is it running? (Endpoint: /api/generate, non-streamed)`;
                if (!((_a = error.message) === null || _a === void 0 ? void 0 : _a.includes('Ollama API error'))) {
                    this.plugin.logger.error(`[OllamaService] Connection/Fetch Error (generateRaw): ${connectionErrorMsg}`, error);
                    this.emit('connection-error', new Error(connectionErrorMsg));
                }
                throw new Error(error.message || connectionErrorMsg);
            }
        });
    }
    generateEmbeddings(prompts, model) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!prompts || prompts.length === 0)
                return [];
            const endpoint = '/api/embeddings';
            const url = `${this.plugin.settings.ollamaServerUrl}${endpoint}`;
            const headers = { 'Content-Type': 'application/json' };
            const embeddingsList = [];
            try {
                for (const prompt of prompts) {
                    const trimmedPrompt = prompt.trim();
                    if (!trimmedPrompt)
                        continue;
                    const requestBody = JSON.stringify({ model: model, prompt: trimmedPrompt });
                    try {
                        const response = yield fetch(url, { method: 'POST', headers, body: requestBody });
                        if (!response.ok) {
                            let errorText = `Ollama Embeddings API error! Status: ${response.status}`;
                            try {
                                const errJson = yield response.json();
                                errorText += `: ${(errJson === null || errJson === void 0 ? void 0 : errJson.error) || 'Details unavailable'}`;
                            }
                            catch (_a) { }
                            this.plugin.logger.warn(`[OllamaService] Embeddings API Error for prompt "${trimmedPrompt.substring(0, 30)}...": ${errorText}`);
                            // Продовжуємо з іншими промптами
                            continue;
                        }
                        const embeddingResponse = yield response.json();
                        if (embeddingResponse && embeddingResponse.embedding) {
                            embeddingsList.push(embeddingResponse.embedding);
                        }
                        else {
                            this.plugin.logger.warn(`[OllamaService] Valid response but no embedding found for prompt "${trimmedPrompt.substring(0, 30)}..."`);
                        }
                    }
                    catch (singleError) {
                        this.plugin.logger.error(`[OllamaService] Error generating embedding for prompt "${trimmedPrompt.substring(0, 30)}...": ${singleError.message}`, singleError);
                        this.emit('connection-error', new Error(singleError.message || 'Embedding generation failed for a prompt'));
                        // Продовжуємо
                    }
                }
                return embeddingsList.length > 0 ? embeddingsList : null;
            }
            catch (error) {
                // Ця зовнішня помилка малоймовірна, якщо внутрішні обробляються
                this.plugin.logger.error(`[OllamaService] Outer error in generateEmbeddings: ${error.message}`, error);
                return null;
            }
        });
    }
    getModels() {
        return __awaiter(this, arguments, void 0, function* (forceRefresh = false) {
            var _a;
            // `forceRefresh` тут не використовується, оскільки ми не кешуємо список моделей в цьому сервісі.
            // Якщо кешування буде додано, тоді `forceRefresh` стане актуальним.
            const endpoint = '/api/tags';
            const url = `${this.plugin.settings.ollamaServerUrl}${endpoint}`;
            let modelListResult = [];
            try {
                const response = yield fetch(url, { method: 'GET' });
                if (!response.ok) {
                    let errorText = `Ollama Tags API error! Status: ${response.status}`;
                    try {
                        const errJson = yield response.json();
                        errorText += `: ${(errJson === null || errJson === void 0 ? void 0 : errJson.error) || 'Details unavailable'}`;
                    }
                    catch (_b) { }
                    this.plugin.logger.error(`[OllamaService] Tags API Error: ${errorText}`);
                    this.emit('connection-error', new Error(errorText));
                    // Повертаємо порожній масив у випадку помилки API, щоб UI не "завис"
                    return [];
                }
                const data = yield response.json(); // Додав більше полів для типу
                if (data && Array.isArray(data.models)) {
                    modelListResult = data.models
                        .map((m) => m === null || m === void 0 ? void 0 : m.name)
                        .filter((name) => typeof name === 'string' && name.length > 0)
                        .sort();
                }
                else {
                    this.plugin.logger.warn("[OllamaService] Received unexpected data format from /api/tags", data);
                }
            }
            catch (e) {
                const connectionErrorMsg = `Failed to connect or fetch models from Ollama server at ${this.plugin.settings.ollamaServerUrl}. (Endpoint: /api/tags)`;
                if (!((_a = e.message) === null || _a === void 0 ? void 0 : _a.includes('API error'))) { // Avoid duplicate emits
                    this.plugin.logger.error(`[OllamaService] Connection/Fetch Error (getModels): ${connectionErrorMsg}`, e);
                    this.emit('connection-error', new Error(e.message || connectionErrorMsg));
                }
                // Повертаємо порожній масив, щоб UI міг це обробити
                return [];
            }
            return modelListResult;
        });
    }
    getModelDetails(modelName) {
        return __awaiter(this, void 0, void 0, function* () {
            var _a;
            const endpoint = '/api/show';
            const url = `${this.plugin.settings.ollamaServerUrl}${endpoint}`;
            const headers = { 'Content-Type': 'application/json' };
            try {
                const response = yield fetch(url, { method: 'POST', headers, body: JSON.stringify({ name: modelName }) });
                if (!response.ok) {
                    let errorText = `Ollama Show API error for model ${modelName}! Status: ${response.status}`;
                    try {
                        const errJson = yield response.json();
                        errorText += `: ${(errJson === null || errJson === void 0 ? void 0 : errJson.error) || 'Details unavailable'}`;
                    }
                    catch (_b) { }
                    this.plugin.logger.error(`[OllamaService] Show API Error: ${errorText}`);
                    if (response.status !== 404) { // Не емітуємо помилку з'єднання, якщо це просто "модель не знайдено"
                        this.emit('connection-error', new Error(errorText));
                    }
                    return null; // Повертаємо null, якщо модель не знайдено або інша помилка
                }
                const data = yield response.json();
                return data;
            }
            catch (e) {
                const connectionErrorMsg = `Failed to connect or get details for model ${modelName} from Ollama server at ${this.plugin.settings.ollamaServerUrl}. (Endpoint: /api/show)`;
                if (!((_a = e.message) === null || _a === void 0 ? void 0 : _a.includes('API error'))) {
                    this.plugin.logger.error(`[OllamaService] Connection/Fetch Error (getModelDetails): ${connectionErrorMsg}`, e);
                    this.emit('connection-error', new Error(e.message || connectionErrorMsg));
                }
                return null;
            }
        });
    }
} // --- End of OllamaService class ---
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2xsYW1hU2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk9sbGFtYVNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsbUJBQW1COztBQTZCbkIsTUFBTSxPQUFPLGFBQWE7SUFNeEIsWUFBWSxNQUFvQjtRQUh4QixrQkFBYSxHQUE4QyxFQUFFLENBQUM7UUFJcEUsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUMxQixNQUFNLFFBQVEsR0FBRyw2R0FBNkcsQ0FBQztZQUMvSCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQywrQkFBK0I7WUFDbkUsTUFBTSxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM1QixDQUFDO1FBQ0QsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDO1FBQzFDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLCtCQUErQjtJQUM5RCxDQUFDO0lBRUQsNkNBQTZDO0lBQzdDLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBNEI7UUFDNUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO1lBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDL0QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDekMsT0FBTyxHQUFHLEVBQUU7O1lBQ1YsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxNQUFBLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLDBDQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxRQUFRLENBQUMsQ0FB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QUFDLHFFQUFxRTt3QkFDaEcsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUN4RCxDQUFDO29CQUNELE9BQU8sSUFBSSxDQUFDLENBQUMsNERBQTREO2dCQUMzRSxDQUFDO2dCQUNELE1BQU0sSUFBSSxHQUFHLE1BQU0sUUFBUSxDQUFDLElBQUksRUFBd0IsQ0FBQztnQkFDekQsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztnQkFDaEIsTUFBTSxrQkFBa0IsR0FBRyw4Q0FBOEMsU0FBUywwQkFBMEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsZUFBZSx5QkFBeUIsQ0FBQztnQkFDMUssSUFBSSxDQUFDLENBQUEsTUFBQSxDQUFDLENBQUMsT0FBTywwQ0FBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUEsRUFBRSxDQUFDO29CQUN0QyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsNkRBQTZELGtCQUFrQixFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQy9HLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7Z0JBQzVFLENBQUM7Z0JBQ0QsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDO1FBQ0gsQ0FBQztLQUFBO0NBRUYsQ0FBQyxxQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBPbGxhbWFTZXJ2aWNlLnRzXG5cbmltcG9ydCBPbGxhbWFQbHVnaW4gZnJvbSAnLi9tYWluJztcbi8vINCS0LDQttC70LjQstC+OiDQhtC80L/QvtGA0YLRg9GU0LzQviDRgtC40L/QuCwg0Y/QutGWINCy0LjQt9C90LDRh9C40LvQuCDQstC40YnQtSDQsNCx0L4g0YLRliwg0YnQviDQstC20LUg0ZQg0YMg0LLQsNGI0L7QvNGDINC/0YDQvtC10LrRgtGWXG5pbXBvcnQge1xuICBPbGxhbWFHZW5lcmF0ZUNodW5rLCAvLyDQn9GA0LjQv9GD0YHRgtC40LzQviwg0YbQtSDQstCw0Ygg0YLQuNC/INC00LvRjyDQt9Cy0LjRh9Cw0LnQvdC+0LPQviDRh9Cw0L3QutCwINCy0ZbQtNC/0L7QstGW0LTRllxuICBPbGxhbWFFcnJvckNodW5rLCAgIC8vINCS0LDRiCDRgtC40L8g0LTQu9GPINC/0L7QvNC40LvQutC4XG4gIE1lc3NhZ2UsICAgICAgICAgICAgLy8g0JLQsNGIINGW0L3RgtC10YDRhNC10LnRgSBNZXNzYWdlXG4gIE9sbGFtYUVtYmVkZGluZ3NSZXNwb25zZSxcbiAgT2xsYW1hR2VuZXJhdGVSZXNwb25zZSxcbiAgT2xsYW1hU2hvd1Jlc3BvbnNlLFxuICAvLyDQlNC+0LTQsNC80L4g0YLQuNC/0Lgg0LTQu9GPINC/0L7RgtC+0LrRgywg0Y/QutGJ0L4g0ZfRhSDRidC1INC90LXQvNCw0ZQ6XG4gIFRvb2xDYWxsLFxuICBBc3Npc3RhbnRNZXNzYWdlIC8vINCi0LjQvyDQtNC70Y8g0L/QvtCy0ZbQtNC+0LzQu9C10L3QvdGPINCw0YHQuNGB0YLQtdC90YLQsCwg0YnQviDQvNC+0LbQtSDQvNGW0YHRgtC40YLQuCB0b29sX2NhbGxzXG59IGZyb20gJy4vdHlwZXMnOyAvLyDQkNC00LDQv9GC0YPQudGC0LUg0YjQu9GP0YUg0LTQviDQstCw0YjQuNGFINGC0LjQv9GW0LJcblxuaW1wb3J0IHsgUHJvbXB0U2VydmljZSB9IGZyb20gJy4vUHJvbXB0U2VydmljZSc7XG5pbXBvcnQgeyBDaGF0LCBDaGF0TWV0YWRhdGEgfSBmcm9tICcuL0NoYXQnOyAvLyDQn9GA0LjQv9GD0YHQutCw0Y7Rh9C4LCDRidC+IENoYXRNZXRhZGF0YSDRltGB0L3Rg9GUXG5pbXBvcnQgeyBJVG9vbEZ1bmN0aW9uIH0gZnJvbSAnLi9hZ2VudHMvSUFnZW50JzsgLy8g0IbQvdGC0LXRgNGE0LXQudGBINC00LvRjyDQstC40LfQvdCw0YfQtdC90L3RjyDRltC90YHRgtGA0YPQvNC10L3RgtGW0LJcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vTG9nZ2VyJztcblxuLy8g0JLQuNC30L3QsNGH0LjQvNC+INGC0LjQv9C4INGH0LDQvdC60ZbQsiwg0Y/QutGWINCx0YPQtNC1INC/0L7QstC10YDRgtCw0YLQuCDQvdCw0Ygg0L/QvtGC0ZbQulxuZXhwb3J0IHR5cGUgU3RyZWFtQ2h1bmsgPVxuICB8IHsgdHlwZTogJ2NvbnRlbnQnOyByZXNwb25zZTogc3RyaW5nOyBkb25lOiBib29sZWFuOyBtb2RlbDogc3RyaW5nOyBjcmVhdGVkX2F0OiBzdHJpbmc7IH1cbiAgfCB7IHR5cGU6ICd0b29sX2NhbGxzJzsgY2FsbHM6IFRvb2xDYWxsW107IGFzc2lzdGFudF9tZXNzYWdlX3dpdGhfY2FsbHM6IEFzc2lzdGFudE1lc3NhZ2U7IG1vZGVsOiBzdHJpbmc7IGNyZWF0ZWRfYXQ6IHN0cmluZzsgfVxuICB8IHsgdHlwZTogJ2RvbmUnOyBtb2RlbDogc3RyaW5nOyBjcmVhdGVkX2F0OiBzdHJpbmc7IGNvbnRleHQ/OiBudW1iZXJbXTsgdG90YWxfZHVyYXRpb24/OiBudW1iZXI7IGxvYWRfZHVyYXRpb24/OiBudW1iZXI7IHByb21wdF9ldmFsX2NvdW50PzogbnVtYmVyOyBwcm9tcHRfZXZhbF9kdXJhdGlvbj86IG51bWJlcjsgZXZhbF9jb3VudD86IG51bWJlcjsgZXZhbF9kdXJhdGlvbj86IG51bWJlcjsgfVxuICB8IHsgdHlwZTogJ2Vycm9yJzsgZXJyb3I6IHN0cmluZzsgZG9uZTogdHJ1ZTsgfTtcblxuXG5leHBvcnQgY2xhc3MgT2xsYW1hU2VydmljZSB7XG4gIHByaXZhdGUgcGx1Z2luOiBPbGxhbWFQbHVnaW47XG4gIHByaXZhdGUgcHJvbXB0U2VydmljZTogUHJvbXB0U2VydmljZTtcbiAgcHJpdmF0ZSBldmVudEhhbmRsZXJzOiBSZWNvcmQ8c3RyaW5nLCBBcnJheTwoZGF0YTogYW55KSA9PiBhbnk+PiA9IHt9O1xuICBsb2dnZXI6IExvZ2dlcjtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IE9sbGFtYVBsdWdpbikge1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIGlmICghcGx1Z2luLnByb21wdFNlcnZpY2UpIHtcbiAgICAgIGNvbnN0IGVycm9yTXNnID0gXCJbT2xsYW1hU2VydmljZV0gQ1JJVElDQUw6IFByb21wdFNlcnZpY2Ugbm90IGF2YWlsYWJsZSBvbiBwbHVnaW4gaW5zdGFuY2UgZHVyaW5nIE9sbGFtYVNlcnZpY2UgY29uc3RydWN0aW9uIVwiO1xuICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKGVycm9yTXNnKTsgLy8g0JLQuNC60L7RgNC40YHRgtC+0LLRg9GU0LzQviDQu9C+0LPQtdGAINC/0LvQsNCz0ZbQvdCwXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNc2cpO1xuICAgIH1cbiAgICB0aGlzLnByb21wdFNlcnZpY2UgPSBwbHVnaW4ucHJvbXB0U2VydmljZTtcbiAgICB0aGlzLmxvZ2dlciA9IHBsdWdpbi5sb2dnZXI7IC8vINCS0LjQutC+0YDQuNGB0YLQvtCy0YPRlNC80L4g0LvQvtCz0LXRgCDQv9C70LDQs9GW0L3QsFxuICB9XG5cbiAgLy8gLS0tIEV2ZW50IEVtaXR0ZXIgKNC30LDQu9C40YjQsNGU0LzQviDQsdC10Lcg0LfQvNGW0L0pIC0tLVxuICBvbihldmVudDogc3RyaW5nLCBjYWxsYmFjazogKGRhdGE6IGFueSkgPT4gYW55KTogKCkgPT4gdm9pZCB7XG4gICAgaWYgKCF0aGlzLmV2ZW50SGFuZGxlcnNbZXZlbnRdKSB0aGlzLmV2ZW50SGFuZGxlcnNbZXZlbnRdID0gW107XG4gICAgdGhpcy5ldmVudEhhbmRsZXJzW2V2ZW50XS5wdXNoKGNhbGxiYWNrKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdGhpcy5ldmVudEhhbmRsZXJzW2V2ZW50XSA9IHRoaXMuZXZlbnRIYW5kbGVyc1tldmVudF0/LmZpbHRlcihoID0+IGggIT09IGNhbGxiYWNrKTtcbiAgICAgIGlmICh0aGlzLmV2ZW50SGFuZGxlcnNbZXZlbnRdPy5sZW5ndGggPT09IDApIGRlbGV0ZSB0aGlzLmV2ZW50SGFuZGxlcnNbZXZlbnRdO1xuICAgIH07XG4gIH1cblxuICBlbWl0KGV2ZW50OiBzdHJpbmcsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBoID0gdGhpcy5ldmVudEhhbmRsZXJzW2V2ZW50XTtcbiAgICBpZiAoaCkgaC5zbGljZSgpLmZvckVhY2goaGFuZGxlciA9PiB7IHRyeSB7IGhhbmRsZXIoZGF0YSk7IH0gY2F0Y2ggKGUpIHsgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKGBFcnJvciBpbiBPbGxhbWFTZXJ2aWNlIGV2ZW50IGhhbmRsZXIgZm9yICR7ZXZlbnR9OmAsIGUpOyB9IH0pO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKlxuICAqINCS0ZbQtNC/0YDQsNCy0LvRj9GUINC30LDQv9C40YIg0L3QsCDQs9C10L3QtdGA0LDRhtGW0Y4g0LLRltC00L/QvtCy0ZbQtNGWIE9sbGFtYSDRliDQv9C+0LLQtdGA0YLQsNGUINCw0YHQuNC90YXRgNC+0L3QvdC40Lkg0ZbRgtC10YDQsNGC0L7RgCDQtNC70Y8g0L7RgtGA0LjQvNCw0L3QvdGPINGH0LDRgdGC0LjQvSDQstGW0LTQv9C+0LLRltC00ZYuXG4gICogQHBhcmFtIGNoYXQg0J/QvtGC0L7Rh9C90LjQuSDQvtCxJ9GU0LrRgiDRh9Cw0YLRgy5cbiAgKiBAcGFyYW0gc2lnbmFsIEFib3J0U2lnbmFsINC00LvRjyDQvNC+0LbQu9C40LLQvtGB0YLRliDQv9C10YDQtdGA0LjQstCw0L3QvdGPINC30LDQv9C40YLRgy5cbiAgKiBAcmV0dXJucyDQkNGB0LjQvdGF0YDQvtC90L3QuNC5INGW0YLQtdGA0LDRgtC+0YAsINGJ0L4g0LLQuNC00LDRlCBTdHJlYW1DaHVuay5cbiAgKi9cbiAgYXN5bmMqIGdlbmVyYXRlQ2hhdFJlc3BvbnNlU3RyZWFtKFxuICAgIGNoYXQ6IENoYXQsIC8vINCX0LDQu9C40YjQsNGU0LzQviBjaGF0LCDQvtGB0LrRltC70YzQutC4IFByb21wdFNlcnZpY2Ug0L/QvtGC0YDQtdCx0YPRlCBDaGF0TWV0YWRhdGFcbiAgICBzaWduYWw/OiBBYm9ydFNpZ25hbFxuICApOiBBc3luY0l0ZXJhYmxlSXRlcmF0b3I8U3RyZWFtQ2h1bms+IHtcbiAgICBjb25zdCByZXF1ZXN0VGltZXN0YW1wSWQgPSBEYXRlLm5vdygpOyAvLyDQlNC70Y8g0LvQvtCz0YPQstCw0L3QvdGPXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYFtPbGxhbWFTZXJ2aWNlXVtpZDoke3JlcXVlc3RUaW1lc3RhbXBJZH1dIGdlbmVyYXRlQ2hhdFJlc3BvbnNlU3RyZWFtIGluaXRpYXRlZCBmb3IgY2hhdCAke2NoYXQubWV0YWRhdGEuaWR9YCk7XG4gICAgaWYgKCFjaGF0KSB7XG4gICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoXCJbT2xsYW1hU2VydmljZV0gZ2VuZXJhdGVDaGF0UmVzcG9uc2VTdHJlYW0gY2FsbGVkIHdpdGggbnVsbCBjaGF0IG9iamVjdC5cIik7XG4gICAgICB5aWVsZCB7IHR5cGU6ICdlcnJvcicsIGVycm9yOiBcIkNoYXQgb2JqZWN0IGlzIG51bGwuXCIsIGRvbmU6IHRydWUgfTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCF0aGlzLnByb21wdFNlcnZpY2UpIHtcbiAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihcIltPbGxhbWFTZXJ2aWNlXSBQcm9tcHRTZXJ2aWNlIGlzIHVuYXZhaWxhYmxlLlwiKTtcbiAgICAgIHlpZWxkIHsgdHlwZTogJ2Vycm9yJywgZXJyb3I6IFwiUHJvbXB0IHNlcnZpY2UgaXMgdW5hdmFpbGFibGUuXCIsIGRvbmU6IHRydWUgfTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50U2V0dGluZ3MgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncztcbiAgICBjb25zdCBtb2RlbE5hbWUgPSBjaGF0Lm1ldGFkYXRhLm1vZGVsTmFtZSB8fCBjdXJyZW50U2V0dGluZ3MubW9kZWxOYW1lOyAvLyDQnNC+0LTQtdC70Ywg0Lcg0LzQtdGC0LDQtNCw0L3QuNGFINGH0LDRgtGDINCw0LHQviDQtNC10YTQvtC70YLQvdCwXG4gICAgY29uc3QgdGVtcGVyYXR1cmUgPSBjaGF0Lm1ldGFkYXRhLnRlbXBlcmF0dXJlID8/IGN1cnJlbnRTZXR0aW5ncy50ZW1wZXJhdHVyZTsgLy8g0KLQtdC80L/QtdGA0LDRgtGD0YDQsCDQtyDQvNC10YLQsNC00LDQvdC40YUg0LDQsdC+INC00LXRhNC+0LvRgtC90LBcblxuICAgIGlmICghbW9kZWxOYW1lKSB7XG4gICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoXCJbT2xsYW1hU2VydmljZV0gTm8gT2xsYW1hIG1vZGVsIHNlbGVjdGVkIGZvciBjaGF0LlwiLCBjaGF0Lm1ldGFkYXRhKTtcbiAgICAgIHlpZWxkIHsgdHlwZTogJ2Vycm9yJywgZXJyb3I6IFwiTm8gT2xsYW1hIG1vZGVsIHNlbGVjdGVkLlwiLCBkb25lOiB0cnVlIH07XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hU2VydmVyVXJsfS9hcGkvZ2VuZXJhdGVgO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBoaXN0b3J5ID0gY2hhdC5nZXRNZXNzYWdlcygpOyAvLyDQntGC0YDQuNC80YPRlNC80L4g0ZbRgdGC0L7RgNGW0Y4g0Lcg0L7QsSfRlNC60YLQsCBDaGF0XG4gICAgICBjb25zdCBzeXN0ZW1Qcm9tcHQgPSBhd2FpdCB0aGlzLnByb21wdFNlcnZpY2UuZ2V0U3lzdGVtUHJvbXB0Rm9yQVBJKGNoYXQubWV0YWRhdGEpO1xuICAgICAgY29uc3QgcHJvbXB0Qm9keSA9IGF3YWl0IHRoaXMucHJvbXB0U2VydmljZS5wcmVwYXJlUHJvbXB0Qm9keShoaXN0b3J5LCBjaGF0Lm1ldGFkYXRhKTtcblxuICAgICAgaWYgKHByb21wdEJvZHkgPT09IG51bGwgfHwgcHJvbXB0Qm9keSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihcIltPbGxhbWFTZXJ2aWNlXSBDb3VsZCBub3QgZ2VuZXJhdGUgcHJvbXB0IGJvZHkgZm9yIGNoYXQuXCIsIGNoYXQubWV0YWRhdGEpO1xuICAgICAgICB5aWVsZCB7IHR5cGU6ICdlcnJvcicsIGVycm9yOiBcIkNvdWxkIG5vdCBnZW5lcmF0ZSBwcm9tcHQgYm9keS5cIiwgZG9uZTogdHJ1ZSB9O1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlcXVlc3RCb2R5OiBhbnkgPSB7XG4gICAgICAgIG1vZGVsOiBtb2RlbE5hbWUsXG4gICAgICAgIHByb21wdDogcHJvbXB0Qm9keSxcbiAgICAgICAgc3RyZWFtOiB0cnVlLFxuICAgICAgICB0ZW1wZXJhdHVyZTogdGVtcGVyYXR1cmUsXG4gICAgICAgIG9wdGlvbnM6IHsgbnVtX2N0eDogY3VycmVudFNldHRpbmdzLmNvbnRleHRXaW5kb3cgfSxcbiAgICAgICAgLi4uKHN5c3RlbVByb21wdCAmJiB7IHN5c3RlbTogc3lzdGVtUHJvbXB0IH0pXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5wbHVnaW4uYWdlbnRNYW5hZ2VyICYmIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZVRvb2xVc2UpIHtcbiAgICAgICAgY29uc3QgYWdlbnRUb29sczogSVRvb2xGdW5jdGlvbltdID0gdGhpcy5wbHVnaW4uYWdlbnRNYW5hZ2VyLmdldEFsbFRvb2xEZWZpbml0aW9ucygpO1xuICAgICAgICBpZiAoYWdlbnRUb29scyAmJiBhZ2VudFRvb2xzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyDQn9C10YDQtdCy0ZbRgNC60LAsINGH0Lgg0LzQvtC00LXQu9GMINC80L7QttC1INC/0ZbQtNGC0YDQuNC80YPQstCw0YLQuCDRltC90YHRgtGA0YPQvNC10L3RgtC4ICjQtNGD0LbQtSDQv9GA0LjQsdC70LjQt9C90LApXG4gICAgICAgICAgLy8g0JrRgNCw0YnQtSDQvNCw0YLQuCDRgdC/0LjRgdC+0Log0LzQvtC00LXQu9C10LksINGJ0L4g0L/RltC00YLRgNC40LzRg9GO0YLRjCDRltC90YHRgtGA0YPQvNC10L3RgtC4LCDQsNCx0L4g0L/QtdGA0LXQstGW0YDRj9GC0Lgg0LzQvtC20LvQuNCy0L7RgdGC0ZYg0LzQvtC00LXQu9GWINGW0L3RiNC40Lwg0YjQu9GP0YXQvtC8XG4gICAgICAgICAgY29uc3QgbW9kZWxEZXRhaWxzID0gYXdhaXQgdGhpcy5nZXRNb2RlbERldGFpbHMobW9kZWxOYW1lKTtcbiAgICAgICAgICBjb25zdCBzZWVtc1RvU3VwcG9ydFRvb2xzID0gbW9kZWxEZXRhaWxzPy5kZXRhaWxzPy5mYW1pbHk/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJsbGFtYTNcIikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWxEZXRhaWxzPy5kZXRhaWxzPy5mYW1pbHk/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJtaXN0cmFsXCIpIHx8IC8vINCU0L7QtNCw0LnRgtC1INGW0L3RiNGWINCy0ZbQtNC+0LzRliDRgdGW0Lwn0ZdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1vZGVsRGV0YWlscz8uZGV0YWlscz8ucGFyYW1ldGVyX3NpemUgJiYgcGFyc2VGbG9hdChtb2RlbERldGFpbHMuZGV0YWlscy5wYXJhbWV0ZXJfc2l6ZS5yZXBsYWNlKCdCJywnJykpID49IDcpO1xuXG5cbiAgICAgICAgICBpZiAoc2VlbXNUb1N1cHBvcnRUb29scykge1xuICAgICAgICAgICAgcmVxdWVzdEJvZHkudG9vbHMgPSBhZ2VudFRvb2xzLm1hcCh0b29sID0+ICh7IHR5cGU6IFwiZnVuY3Rpb25cIiwgZnVuY3Rpb246IHRvb2wgfSkpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmluZm8oYFtPbGxhbWFTZXJ2aWNlXSBUb29scyBwcm92aWRlZCB0byBPbGxhbWEgZm9yIG1vZGVsICR7bW9kZWxOYW1lfTpgLCBhZ2VudFRvb2xzLm1hcCh0ID0+IHQubmFtZSkpO1xuICAgICAgICAgICAgLy8gcmVxdWVzdEJvZHkuZm9ybWF0ID0gJ2pzb24nOyAvLyDQoNC+0LfQutC+0LzQtdC90YLRg9C50YLQtSwg0Y/QutGJ0L4g0LzQvtC00LXQu9GMINGG0YzQvtCz0L4g0LLQuNC80LDQs9Cw0ZQg0LTQu9GPIHRvb2xfY2FsbHMuINCe0JHQldCg0JXQltCd0J4hXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5pbmZvKGBbT2xsYW1hU2VydmljZV0gTW9kZWwgJHttb2RlbE5hbWV9IG1pZ2h0IG5vdCBuYXRpdmVseSBzdXBwb3J0IHRvb2wgY2FsbGluZyAob3IgY2hlY2sgZmFpbGVkKS4gVG9vbHMgbm90IGV4cGxpY2l0bHkgc2VudCB2aWEgJ3Rvb2xzJyBwYXJhbWV0ZXIuIFJlbHlpbmcgb24gcHJvbXB0LWJhc2VkIGZhbGxiYWNrIGlmIGltcGxlbWVudGVkLmApO1xuICAgICAgICAgICAgLy8g0KLRg9GCINC80L7QttC1INCx0YPRgtC4INC70L7Qs9GW0LrQsCDQtNC70Y8g0LTQvtC00LDQstCw0L3QvdGPINGW0L3RgdGC0YDRg9C60YbRltC5INC00LvRjyBmYWxsYmFjay3QvNC10YXQsNC90ZbQt9C80YMg0LIgc3lzdGVtUHJvbXB0INCw0LHQviBwcm9tcHRCb2R5LFxuICAgICAgICAgICAgLy8g0Y/QutGJ0L4g0LLQuCDQstC40YDRltGI0LjRgtC1INC50L7Qs9C+INGA0LXQsNC70ZbQt9GD0LLQsNGC0LguXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5kZWJ1ZyhgW09sbGFtYVNlcnZpY2VdIFNlbmRpbmcgcmVxdWVzdCB0byAke3VybH0gZm9yIG1vZGVsICR7bW9kZWxOYW1lfS4gU3lzdGVtIHByb21wdCBsZW5ndGg6ICR7c3lzdGVtUHJvbXB0Py5sZW5ndGggfHwgMH0sIEJvZHkgcHJvbXB0IGxlbmd0aDogJHtwcm9tcHRCb2R5Lmxlbmd0aH1gKTtcbiAgICAgIC8vIHRoaXMucGx1Z2luLmxvZ2dlci5kZWJ1ZyhgW09sbGFtYVNlcnZpY2VdIFJlcXVlc3QgYm9keTogJHtKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSwgbnVsbCwgMil9YCk7XG5cblxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYFtPbGxhbWFTZXJ2aWNlXVtpZDoke3JlcXVlc3RUaW1lc3RhbXBJZH1dIFNlbmRpbmcgcmVxdWVzdCB0byAke3VybH0gZm9yIG1vZGVsICR7bW9kZWxOYW1lfS4gUHJvbXB0IGxlbmd0aDogJHtwcm9tcHRCb2R5Lmxlbmd0aH0uIFN5c3RlbSBwYXJ0IGxlbmd0aDogJHtzeXN0ZW1Qcm9tcHQ/Lmxlbmd0aCB8fCAwfWApO1xuICAgICAgdGhpcy5sb2dnZXIudHJhY2UoYFtPbGxhbWFTZXJ2aWNlXVtpZDoke3JlcXVlc3RUaW1lc3RhbXBJZH1dIFJlcXVlc3QgYm9keTpgLCByZXF1ZXN0Qm9keSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0Qm9keSksXG4gICAgICAgIHNpZ25hbDogc2lnbmFsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBsZXQgZXJyb3JUZXh0ID0gYE9sbGFtYSBBUEkgZXJyb3IhIFN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBlcnJvckpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgZXJyb3JUZXh0ICs9IGA6ICR7ZXJyb3JKc29uPy5lcnJvciB8fCByZXNwb25zZS5zdGF0dXNUZXh0IHx8ICdObyBkZXRhaWxzJ31gO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgZXJyb3JUZXh0ICs9IGA6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dCB8fCAnQ291bGQgbm90IHBhcnNlIGVycm9yIGRldGFpbHMnfWA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKGBbT2xsYW1hU2VydmljZV0gQVBJIEVycm9yOiAke2Vycm9yVGV4dH1gLCByZXF1ZXN0Qm9keSk7XG4gICAgICAgIHRoaXMuZW1pdCgnY29ubmVjdGlvbi1lcnJvcicsIG5ldyBFcnJvcihlcnJvclRleHQpKTtcbiAgICAgICAgeWllbGQgeyB0eXBlOiAnZXJyb3InLCBlcnJvcjogZXJyb3JUZXh0LCBkb25lOiB0cnVlIH07XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFyZXNwb25zZS5ib2R5KSB7XG4gICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihcIltPbGxhbWFTZXJ2aWNlXSBSZXNwb25zZSBib2R5IGlzIG51bGwuXCIpO1xuICAgICAgICB5aWVsZCB7IHR5cGU6ICdlcnJvcicsIGVycm9yOiBcIlJlc3BvbnNlIGJvZHkgaXMgbnVsbC5cIiwgZG9uZTogdHJ1ZSB9O1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7XG4gICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgICBsZXQgYnVmZmVyID0gJyc7XG4gICAgICBsZXQgcmF3UmVzcG9uc2VBY2N1bXVsYXRvciA9IFwiXCI7IFxuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgeyBkb25lLCB2YWx1ZSB9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTtcblxuICAgICAgICBpZiAoc2lnbmFsPy5hYm9ydGVkKSB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmluZm8oXCJbT2xsYW1hU2VydmljZV0gU3RyZWFtIGdlbmVyYXRpb24gYWJvcnRlZCBieSB1c2VyIHNpZ25hbC5cIik7XG4gICAgICAgICAgcmVhZGVyLmNhbmNlbChcIkFib3J0ZWQgYnkgdXNlclwiKTtcbiAgICAgICAgICB5aWVsZCB7IHR5cGU6ICdlcnJvcicsIGVycm9yOiBcIkdlbmVyYXRpb24gYWJvcnRlZCBieSB1c2VyLlwiLCBkb25lOiB0cnVlIH07XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRlY29kZWRDaHVuayA9IGRlY29kZXIuZGVjb2RlKHZhbHVlLCB7IHN0cmVhbTogIWRvbmUgfSk7XG4gICAgICAgIC8vIC0tLSDQm9Ce0JPQo9CS0JDQndCd0K8g0KHQmNCg0J7Qk9CeINCf0J7QotCe0JrQoyAtLS1cbiAgICAgICAgcmF3UmVzcG9uc2VBY2N1bXVsYXRvciArPSBkZWNvZGVkQ2h1bms7XG5cbiAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuaW5mbyhcIltPbGxhbWFTZXJ2aWNlXSBTdHJlYW0gcmVhZGVyIG1hcmtlZCBhcyBkb25lLlwiKTtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgW09sbGFtYVNlcnZpY2VdW2lkOiR7cmVxdWVzdFRpbWVzdGFtcElkfV0gU3RyZWFtIHJlYWRlciAnZG9uZScuIEZpbmFsIHJhdyBidWZmZXI6IFwiJHtidWZmZXJ9JHtkZWNvZGVkQ2h1bmt9XCJgKTtcbiAgICAgICAgICAvLyAtLS0g0JvQntCT0KPQktCQ0J3QndCvINCf0J7QktCd0J7QhyDQodCY0KDQntCHINCS0IbQlNCf0J7QktCG0JTQhiAtLS1cbiAgICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgW09sbGFtYVNlcnZpY2VdW2lkOiR7cmVxdWVzdFRpbWVzdGFtcElkfV0gPT09IFJBVyBGVUxMIFNUUkVBTSBSRVNQT05TRSAoZnJvbSBPbGxhbWFTZXJ2aWNlKSBTVEFSVCA9PT1gKTtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhyYXdSZXNwb25zZUFjY3VtdWxhdG9yKTtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgW09sbGFtYVNlcnZpY2VdW2lkOiR7cmVxdWVzdFRpbWVzdGFtcElkfV0gPT09IFJBVyBGVUxMIFNUUkVBTSBSRVNQT05TRSAoZnJvbSBPbGxhbWFTZXJ2aWNlKSBFTkQgPT09IExlbmd0aDogJHtyYXdSZXNwb25zZUFjY3VtdWxhdG9yLmxlbmd0aH1gKTtcbiAgICAgICAgICBidWZmZXIgKz0gZGVjb2RlZENodW5rOyAvL0NIRUNLSVRcbiAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgLy8g0J7QsdGA0L7QsdC60LAg0LfQsNC70LjRiNC60YMg0LHRg9GE0LXRgNCwLCDRj9C60YnQviDQstGW0L0g0L3QtSDQv9C+0YDQvtC20L3RltC5INGWINGUINCy0LDQu9GW0LTQvdC40LwgSlNPTlxuICAgICAgICAgIGlmIChidWZmZXIudHJpbSgpKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGpzb25DaHVuayA9IEpTT04ucGFyc2UoYnVmZmVyLnRyaW0oKSk7XG4gICAgICAgICAgICAgICAgLy8g0KbQtSDQvNCw0LvQvtC50LzQvtCy0ZbRgNC90L4sINCw0LvQtSDRj9C60YnQviDQvtGB0YLQsNC90L3RltC5INGH0LDQvdC6INCx0YPQsiDQvdC1IGBkb25lOnRydWVgXG4gICAgICAgICAgICAgICAgaWYgKGpzb25DaHVuay5tZXNzYWdlICYmIGpzb25DaHVuay5tZXNzYWdlLnRvb2xfY2FsbHMgJiYganNvbkNodW5rLm1lc3NhZ2UudG9vbF9jYWxscy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHsgdHlwZTogJ3Rvb2xfY2FsbHMnLCBjYWxsczoganNvbkNodW5rLm1lc3NhZ2UudG9vbF9jYWxscywgYXNzaXN0YW50X21lc3NhZ2Vfd2l0aF9jYWxsczoganNvbkNodW5rLm1lc3NhZ2UsIG1vZGVsOiBqc29uQ2h1bmsubW9kZWwsIGNyZWF0ZWRfYXQ6IGpzb25DaHVuay5jcmVhdGVkX2F0IH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YganNvbkNodW5rLnJlc3BvbnNlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCB7IHR5cGU6ICdjb250ZW50JywgcmVzcG9uc2U6IGpzb25DaHVuay5yZXNwb25zZSwgZG9uZToganNvbkNodW5rLmRvbmUgfHwgZmFsc2UsIG1vZGVsOiBqc29uQ2h1bmsubW9kZWwsIGNyZWF0ZWRfYXQ6IGpzb25DaHVuay5jcmVhdGVkX2F0IH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqc29uQ2h1bmsuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHsgdHlwZTogJ2Vycm9yJywgZXJyb3I6IGpzb25DaHVuay5lcnJvciwgZG9uZTogdHJ1ZSB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyDQr9C60YnQviDRgtGD0YIgYGRvbmU6dHJ1ZWAsINGC0L4g0YbQtSDQstC20LUg0LzQsNC70L4g0LHRg9GC0Lgg0L7QsdGA0L7QsdC70LXQvdC+INCyINGG0LjQutC70ZYg0L3QuNC20YfQtVxuICAgICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLndhcm4oYFtPbGxhbWFTZXJ2aWNlXSBGYWlsZWQgdG8gcGFyc2UgZmluYWwgYnVmZmVyIGNvbnRlbnQ6IFwiJHtidWZmZXIudHJpbSgpfVwiLiBFcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrOyAvLyDQktC40YXRltC0INC3INGG0LjQutC70YMsINC60L7Qu9C4INC/0L7RgtGW0Log0LfQsNCy0LXRgNGI0LXQvdC+XG4gICAgICAgIH1cblxuICAgICAgICBidWZmZXIgKz0gZGVjb2Rlci5kZWNvZGUodmFsdWUsIHsgc3RyZWFtOiB0cnVlIH0pO1xuICAgICAgICBsZXQgZW9sSW5kZXg7XG5cbiAgICAgICAgd2hpbGUgKChlb2xJbmRleCA9IGJ1ZmZlci5pbmRleE9mKCdcXG4nKSkgPj0gMCkge1xuICAgICAgICAgIGNvbnN0IGxpbmUgPSBidWZmZXIuc3Vic3RyaW5nKDAsIGVvbEluZGV4KS50cmltKCk7XG4gICAgICAgICAgYnVmZmVyID0gYnVmZmVyLnN1YnN0cmluZyhlb2xJbmRleCArIDEpO1xuXG4gICAgICAgICAgaWYgKGxpbmUgPT09ICcnKSBjb250aW51ZTtcblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBqc29uQ2h1bmsgPSBKU09OLnBhcnNlKGxpbmUpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmRlYnVnKCdbT2xsYW1hU2VydmljZV0gUmF3IGNodW5rIHJlY2VpdmVkOicsIEpTT04uc3RyaW5naWZ5KGpzb25DaHVuaykpO1xuXG4gICAgICAgICAgICBpZiAoanNvbkNodW5rLmVycm9yKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihgW09sbGFtYVNlcnZpY2VdIEVycm9yIGNodW5rIGZyb20gT2xsYW1hOiAke2pzb25DaHVuay5lcnJvcn1gKTtcbiAgICAgICAgICAgICAgeWllbGQgeyB0eXBlOiAnZXJyb3InLCBlcnJvcjoganNvbkNodW5rLmVycm9yLCBkb25lOiB0cnVlIH07XG4gICAgICAgICAgICAgIHJlYWRlci5jYW5jZWwoXCJFcnJvciByZWNlaXZlZCBmcm9tIE9sbGFtYSBzdHJlYW1cIik7XG4gICAgICAgICAgICAgIHJldHVybjsgLy8g0JLQsNC20LvQuNCy0L4g0LLQuNC50YLQuCwg0Y/QutGJ0L4gT2xsYW1hINC/0L7QstC10YDQvdGD0LvQsCDQv9C+0LzQuNC70LrRg1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyDQn9GA0ZbQvtGA0LjRgtC10YIg0LTQu9GPIHRvb2xfY2FsbHNcbiAgICAgICAgICAgIGlmIChqc29uQ2h1bmsubWVzc2FnZSAmJiBqc29uQ2h1bmsubWVzc2FnZS50b29sX2NhbGxzICYmIGpzb25DaHVuay5tZXNzYWdlLnRvb2xfY2FsbHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoJ1tPbGxhbWFTZXJ2aWNlXSBSYXcgdG9vbF9jYWxscyBjb250ZW50OicsIFxuICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGpzb25DaHVuay5tZXNzYWdlLnRvb2xfY2FsbHMsIG51bGwsIDIpKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmluZm8oJ1tPbGxhbWFTZXJ2aWNlXSBZaWVsZGluZyB0b29sX2NhbGxzIGNodW5rOicsIGpzb25DaHVuay5tZXNzYWdlLnRvb2xfY2FsbHMpO1xuICAgICAgICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3Rvb2xfY2FsbHMnLFxuICAgICAgICAgICAgICAgIGNhbGxzOiBqc29uQ2h1bmsubWVzc2FnZS50b29sX2NhbGxzLFxuICAgICAgICAgICAgICAgIGFzc2lzdGFudF9tZXNzYWdlX3dpdGhfY2FsbHM6IGpzb25DaHVuay5tZXNzYWdlIGFzIEFzc2lzdGFudE1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgbW9kZWw6IGpzb25DaHVuay5tb2RlbCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBqc29uQ2h1bmsuY3JlYXRlZF9hdFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAvLyDQn9GW0YHQu9GPIHRvb2xfY2FsbHMg0LzQvtC00LXQu9GMINC30LDQt9Cy0LjRh9Cw0Lkg0YfQtdC60LDRlCDQvdCwINCy0ZbQtNC/0L7QstGW0LTRjCwg0YLQvtC80YMgZG9uZSDQvNC+0LbQtSDQsdGD0YLQuCBmYWxzZS5cbiAgICAgICAgICAgICAgLy8g0K/QutGJ0L4gZG9uZSDRgtGD0YIgdHJ1ZSwg0YbQtSDQvtC30L3QsNGH0LDRlCwg0YnQviDQvNC+0LTQtdC70Ywg0L3QtSDRh9C10LrQsNGUINGWINC30LDQstC10YDRiNGD0ZQg0YXRltC0LlxuICAgICAgICAgICAgICBpZiAoanNvbkNodW5rLmRvbmUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuaW5mbygnW09sbGFtYVNlcnZpY2VdIFN0cmVhbSBmaW5pc2hlZCAoZG9uZTp0cnVlIHJlY2VpdmVkIHdpdGggdG9vbF9jYWxscyBjaHVuaykuJyk7XG4gICAgICAgICAgICAgICAgeWllbGQge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZG9uZScsXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsOiBqc29uQ2h1bmsubW9kZWwsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IGpzb25DaHVuay5jcmVhdGVkX2F0LFxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBqc29uQ2h1bmsuY29udGV4dCwgLy8g0YLQsCDRltC90YjRliDQvNC10YLRgNC40LrQuCwg0Y/QutGJ0L4g0ZRcbiAgICAgICAgICAgICAgICAgICAgdG90YWxfZHVyYXRpb246IGpzb25DaHVuay50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbG9hZF9kdXJhdGlvbjoganNvbkNodW5rLmxvYWRfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2NvdW50OiBqc29uQ2h1bmsucHJvbXB0X2V2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2R1cmF0aW9uOiBqc29uQ2h1bmsucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGV2YWxfY291bnQ6IGpzb25DaHVuay5ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICBldmFsX2R1cmF0aW9uOiBqc29uQ2h1bmsuZXZhbF9kdXJhdGlvblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYFtPbGxhbWFTZXJ2aWNlXVtpZDoke3JlcXVlc3RUaW1lc3RhbXBJZH1dID09PSBSQVcgRlVMTCBTVFJFQU0gUkVTUE9OU0UgKGZyb20gT2xsYW1hU2VydmljZSBhZnRlciBmaW5hbCBkb25lKSBTVEFSVCA9PT1gKTtcbiAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcocmF3UmVzcG9uc2VBY2N1bXVsYXRvcik7XG4gICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBbT2xsYW1hU2VydmljZV1baWQ6JHtyZXF1ZXN0VGltZXN0YW1wSWR9XSA9PT0gUkFXIEZVTEwgU1RSRUFNIFJFU1BPTlNFIChmcm9tIE9sbGFtYVNlcnZpY2UgYWZ0ZXIgZmluYWwgZG9uZSkgRU5EID09PSBMZW5ndGg6ICR7cmF3UmVzcG9uc2VBY2N1bXVsYXRvci5sZW5ndGh9YCk7XG4gICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGpzb25DaHVuay5yZXNwb25zZSA9PT0gJ3N0cmluZycpIHsgLy8g0KLQtdC60YHRgtC+0LLQuNC5INC60L7QvdGC0LXQvdGCXG4gICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZGVidWcoJ1tPbGxhbWFTZXJ2aWNlXSBZaWVsZGluZyBjb250ZW50IGNodW5rLicpO1xuICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKCdbT2xsYW1hU2VydmljZV0gbWVzOicsIGpzb25DaHVuay5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmRlYnVnKCdbT2xsYW1hU2VydmljZV0gUmF3IGNvbnRlbnQgY2h1bms6JywganNvbkNodW5rLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmRlYnVnKCdbT2xsYW1hU2VydmljZV0gUmF3IGNvbnRlbnQgY2h1bmsgKHN0cmluZ2lmeSk6JywgSlNPTi5zdHJpbmdpZnkoanNvbkNodW5rLnJlc3BvbnNlLCBudWxsLCAyKSk7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5kZWJ1ZygnW09sbGFtYVNlcnZpY2VdIFJhdyBjb250ZW50IGNodW5rIChzdHJpbmdpZnkpOicsIGpzb25DaHVuayk7XG4gICAgICAgICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnY29udGVudCcsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6IGpzb25DaHVuay5yZXNwb25zZSxcbiAgICAgICAgICAgICAgICBkb25lOiBqc29uQ2h1bmsuZG9uZSB8fCBmYWxzZSwgLy8gZG9uZSDQvNC+0LbQtSDQsdGD0YLQuCB0cnVlINGC0YPRgiwg0Y/QutGJ0L4g0YbQtSDQvtGB0YLQsNC90L3RltC5INGC0LXQutGB0YLQvtCy0LjQuSDRh9Cw0L3QulxuICAgICAgICAgICAgICAgIG1vZGVsOiBqc29uQ2h1bmsubW9kZWwsXG4gICAgICAgICAgICAgICAgY3JlYXRlZF9hdDoganNvbkNodW5rLmNyZWF0ZWRfYXRcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgaWYgKGpzb25DaHVuay5kb25lID09PSB0cnVlKSB7IC8vINCv0LrRidC+INGG0LUg0L7RgdGC0LDQvdC90ZbQuSDRgtC10LrRgdGC0L7QstC40Lkg0YfQsNC90Log0ZYgZG9uZT10cnVlXG4gICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmluZm8oJ1tPbGxhbWFTZXJ2aWNlXSBTdHJlYW0gZmluaXNoZWQgKGRvbmU6dHJ1ZSByZWNlaXZlZCB3aXRoIGNvbnRlbnQgY2h1bmspLicpO1xuICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcignW09sbGFtYVNlcnZpY2VdIEZpbmFsIGNodW5rIHdpdGggbWV0cmljczonLCBqc29uQ2h1bmspO1xuXG4gICAgICAgICAgICAgICAgIC8vINCd0LUg0LLRltC00L/RgNCw0LLQu9GP0ZTQvNC+INC+0LrRgNC10LzQuNC5ICdkb25lJyDRh9Cw0L3Quiwg0LHQviDRltC90YTQvtGA0LzQsNGG0ZbRjyDQstC20LUg0LIg0YbRjNC+0LzRgy5cbiAgICAgICAgICAgICAgICAgLy8g0J7QtNC90LDQuiwg0YTRltC90LDQu9GM0L3QuNC5ICdkb25lJyDRh9Cw0L3QuiDQstGW0LQgT2xsYW1hINC30LDQt9Cy0LjRh9Cw0Lkg0LzRltGB0YLQuNGC0Ywg0LHRltC70YzRiNC1INC80LXRgtGA0LjQui5cbiAgICAgICAgICAgICAgICAgLy8g0K/QutGJ0L4g0YbQtSDQvdC1INGE0ZbQvdCw0LvRjNC90LjQuSDRh9Cw0L3QuiDQtyDQvNC10YLRgNC40LrQsNC80LgsINGC0L7QtNGWINC+0YfRltC60YPRlNC80L4g0LnQvtCz0L4uXG4gICAgICAgICAgICAgICAgIC8vINCv0LrRidC+IGBqc29uQ2h1bmtgINCy0LbQtSDQvNGW0YHRgtC40YLRjCDQstGB0ZYg0LzQtdGC0YDQuNC60LgsINGC0L4g0LzQvtC20L3QsCDQv9C+0LLQtdGA0L3Rg9GC0Lgg0LnQvtCz0L4g0Y/QuiBgZG9uZWBcbiAgICAgICAgICAgICAgICAgLy8g0JDQu9C1INC30LDQt9Cy0LjRh9Cw0Lkg0ZQg0L7QutGA0LXQvNC40Lkg0YTRltC90LDQu9GM0L3QuNC5INGH0LDQvdC6INC70LjRiNC1INC3IGBkb25lOnRydWVgINGC0LAg0LzQtdGC0YDQuNC60LDQvNC4LlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGpzb25DaHVuay5kb25lID09PSB0cnVlKSB7IC8vINCk0ZbQvdCw0LvRjNC90LjQuSDRh9Cw0L3QuiBcImRvbmVcIiDQtyDQvNC10YLRgNC40LrQsNC80LhcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmluZm8oJ1tPbGxhbWFTZXJ2aWNlXSBTdHJlYW0gZmluaXNoZWQgKGZpbmFsIGRvbmU6dHJ1ZSBjaHVuayB3aXRoIG1ldHJpY3MpLicpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoJ1tPbGxhbWFTZXJ2aWNlXSBtZXM6JywganNvbkNodW5rLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2RvbmUnLFxuICAgICAgICAgICAgICAgIG1vZGVsOiBqc29uQ2h1bmsubW9kZWwsXG4gICAgICAgICAgICAgICAgY3JlYXRlZF9hdDoganNvbkNodW5rLmNyZWF0ZWRfYXQsXG4gICAgICAgICAgICAgICAgY29udGV4dDoganNvbkNodW5rLmNvbnRleHQsXG4gICAgICAgICAgICAgICAgdG90YWxfZHVyYXRpb246IGpzb25DaHVuay50b3RhbF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBsb2FkX2R1cmF0aW9uOiBqc29uQ2h1bmsubG9hZF9kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBwcm9tcHRfZXZhbF9jb3VudDoganNvbkNodW5rLnByb21wdF9ldmFsX2NvdW50LFxuICAgICAgICAgICAgICAgIHByb21wdF9ldmFsX2R1cmF0aW9uOiBqc29uQ2h1bmsucHJvbXB0X2V2YWxfZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgZXZhbF9jb3VudDoganNvbkNodW5rLmV2YWxfY291bnQsXG4gICAgICAgICAgICAgICAgZXZhbF9kdXJhdGlvbjoganNvbkNodW5rLmV2YWxfZHVyYXRpb25cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcmV0dXJuOyAvLyDQl9Cw0LLQtdGA0YjRg9GU0LzQviDQs9C10L3QtdGA0LDRgtC+0YBcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoanNvbkNodW5rLm1lc3NhZ2UgJiYgKGpzb25DaHVuay5tZXNzYWdlLmNvbnRlbnQgPT09IG51bGwgfHwganNvbkNodW5rLm1lc3NhZ2UuY29udGVudCA9PT0gXCJcIikgJiYgIWpzb25DaHVuay5tZXNzYWdlLnRvb2xfY2FsbHMpIHtcbiAgICAgICAgICAgICAgICAvLyDQptC1INC80L7QttC1INCx0YPRgtC4INC/0L7RgNC+0LbQvdGUINC/0L7QstGW0LTQvtC80LvQtdC90L3RjyDQsNGB0LjRgdGC0LXQvdGC0LAgKNC90LDQv9GALiwg0L/QtdGA0LXQtCB0b29sX2NhbGxzINCw0LHQviDQv9GA0Lgg0LfQsNCy0LXRgNGI0LXQvdC90ZYpXG4gICAgICAgICAgICAgICAgLy8g0K/QutGJ0L4gZG9uZSBmYWxzZSwg0ZbQs9C90L7RgNGD0ZTQvNC+INC50L7Qs9C+LCDRh9C10LrQsNGU0LzQviDQvdCwINC60L7RgNC40YHQvdGWINC00LDQvdGWINCw0LHQviBkb25lOnRydWUuXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5wbHVnaW4ubG9nZ2VyLmRlYnVnKCdbT2xsYW1hU2VydmljZV0gUmVjZWl2ZWQgZW1wdHkgYXNzaXN0YW50IG1lc3NhZ2Ugc2hlbGwsIGlnbm9yaW5nLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZWxzZSB7XG4gICAgICAgICAgICAvLyAgIHRoaXMucGx1Z2luLmxvZ2dlci53YXJuKCdbT2xsYW1hU2VydmljZV0gVW5oYW5kbGVkIG9yIHVuZXhwZWN0ZWQgY2h1bmsgc3RydWN0dXJlOicsIGpzb25DaHVuayk7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIud2FybihgW09sbGFtYVNlcnZpY2VdIEZhaWxlZCB0byBwYXJzZSBKU09OIGNodW5rOiBcIiR7bGluZX1cIi4gRXJyb3I6ICR7ZS5tZXNzYWdlfS4gU2tpcHBpbmcgY2h1bmsuYCk7XG4gICAgICAgICAgICAvLyDQndC1INC60LjQtNCw0ZTQvNC+INC/0L7QvNC40LvQutGDLCDRidC+0LEg0L3QtSDQv9C10YDQtdGA0LLQsNGC0Lgg0LLQtdGB0Ywg0L/QvtGC0ZbQuiDRh9C10YDQtdC3INC+0LTQuNC9INC/0L7RiNC60L7QtNC20LXQvdC40Lkg0YfQsNC90LosXG4gICAgICAgICAgICAvLyDQsNC70LUg0LvQvtCz0YPRlNC80L4g0ZfRly5cbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8g0LrRltC90LXRhtGMIHdoaWxlICgoZW9sSW5kZXggPSBidWZmZXIuaW5kZXhPZignXFxuJykpID49IDApXG4gICAgICB9IC8vINC60ZbQvdC10YbRjCB3aGlsZSAodHJ1ZSlcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmluZm8oXCJbT2xsYW1hU2VydmljZV0gU3RyZWFtIGdlbmVyYXRpb24gYWJvcnRlZCBieSB1c2VyIChjYXVnaHQgQWJvcnRFcnJvcikuXCIpO1xuICAgICAgICB5aWVsZCB7IHR5cGU6ICdlcnJvcicsIGVycm9yOiBcIkdlbmVyYXRpb24gYWJvcnRlZCBieSB1c2VyLlwiLCBkb25lOiB0cnVlIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIlVua25vd24gZXJyb3IgZ2VuZXJhdGluZyBzdHJlYW0uXCI7XG4gICAgICAgIGlmIChlcnJvck1lc3NhZ2UuaW5jbHVkZXMoXCJjb25uZWN0XCIpIHx8IGVycm9yTWVzc2FnZS5pbmNsdWRlcyhcImZldGNoXCIpIHx8IGVycm9yTWVzc2FnZS5pbmNsdWRlcyhcIk5ldHdvcmtFcnJvclwiKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ0ZhaWxlZCB0byBmZXRjaCcpKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlID0gYENvbm5lY3Rpb24gRXJyb3I6IEZhaWxlZCB0byByZWFjaCBPbGxhbWEgYXQgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbGxhbWFTZXJ2ZXJVcmx9LiBJcyBpdCBydW5uaW5nP2A7XG4gICAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0aW9uLWVycm9yJywgbmV3IEVycm9yKGVycm9yTWVzc2FnZSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihgW09sbGFtYVNlcnZpY2VdIEVycm9yIGR1cmluZyBzdHJlYW0gZ2VuZXJhdGlvbjogJHtlcnJvck1lc3NhZ2V9YCwgZXJyb3IpO1xuICAgICAgICB5aWVsZCB7IHR5cGU6ICdlcnJvcicsIGVycm9yOiBlcnJvck1lc3NhZ2UsIGRvbmU6IHRydWUgfTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuaW5mbyhcIltPbGxhbWFTZXJ2aWNlXSBnZW5lcmF0ZUNoYXRSZXNwb25zZVN0cmVhbSBmaW5pc2hlZCBvciB0ZXJtaW5hdGVkLlwiKTtcbiAgICB9XG4gIH1cblxuICAvLyAuLi4gKNGW0L3RiNGWINCy0LDRiNGWINC80LXRgtC+0LTQuDogZ2VuZXJhdGVSYXcsIGdlbmVyYXRlRW1iZWRkaW5ncywgZ2V0TW9kZWxzLCBnZXRNb2RlbERldGFpbHMpIC4uLlxuICAvLyDQn9C10YDQtdC60L7QvdCw0LnRgtC10YHRjywg0YnQviDQstC+0L3QuCDQsNC00LDQv9GC0L7QstCw0L3RliDQtNC70Y8g0LLQuNC60L7RgNC40YHRgtCw0L3QvdGPIHRoaXMucGx1Z2luLmxvZ2dlciDQt9Cw0LzRltGB0YLRjCBjb25zb2xlLmVycm9yL2xvZ1xuICAvLyDRliB0aGlzLmVtaXQoJ2Nvbm5lY3Rpb24tZXJyb3InLCAuLi4pINC00LvRjyDQv9C+0LzQuNC70L7QuiDQtyfRlNC00L3QsNC90L3Rjy5cblxuICBhc3luYyBnZW5lcmF0ZVJhdyhyZXF1ZXN0Qm9keTogYW55KTogUHJvbWlzZTxPbGxhbWFHZW5lcmF0ZVJlc3BvbnNlPiB7XG4gICAgaWYgKCFyZXF1ZXN0Qm9keS5tb2RlbCB8fCAhcmVxdWVzdEJvZHkucHJvbXB0KSB7XG4gICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoXCJbT2xsYW1hU2VydmljZV0gZ2VuZXJhdGVSYXcgY2FsbGVkIHdpdGhvdXQgJ21vZGVsJyBvciAncHJvbXB0Jy5cIik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJnZW5lcmF0ZVJhdyByZXF1aXJlcyAnbW9kZWwnIGFuZCAncHJvbXB0JyBpbiByZXF1ZXN0Qm9keVwiKTtcbiAgICB9XG4gICAgcmVxdWVzdEJvZHkuc3RyZWFtID0gZmFsc2U7XG4gICAgaWYgKCFyZXF1ZXN0Qm9keS5zeXN0ZW0pIHtcbiAgICAgIGRlbGV0ZSByZXF1ZXN0Qm9keS5zeXN0ZW07XG4gICAgfVxuXG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hU2VydmVyVXJsfS9hcGkvZ2VuZXJhdGVgO1xuICAgIGNvbnN0IGhlYWRlcnMgPSB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3RCb2R5KVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgbGV0IGVycm9yVGV4dCA9IGBPbGxhbWEgQVBJIGVycm9yIChnZW5lcmF0ZVJhdykhIFN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBlcnJvckpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgZXJyb3JUZXh0ICs9IGA6ICR7ZXJyb3JKc29uPy5lcnJvciB8fCByZXNwb25zZS5zdGF0dXNUZXh0IHx8ICdObyBkZXRhaWxzJ31gO1xuICAgICAgICB9IGNhdGNoIChlKSB7IGVycm9yVGV4dCArPSBgOiAke3Jlc3BvbnNlLnN0YXR1c1RleHQgfHwgJ0NvdWxkIG5vdCBwYXJzZSBlcnJvciBkZXRhaWxzJ31gOyB9XG4gICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihgW09sbGFtYVNlcnZpY2VdIEFQSSBFcnJvciAoZ2VuZXJhdGVSYXcpOiAke2Vycm9yVGV4dH1gLCByZXF1ZXN0Qm9keSk7XG4gICAgICAgIHRoaXMuZW1pdCgnY29ubmVjdGlvbi1lcnJvcicsIG5ldyBFcnJvcihlcnJvclRleHQpKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yVGV4dCk7XG4gICAgICB9XG4gICAgICBpZiAoIXJlc3BvbnNlLmJvZHkpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKFwiW09sbGFtYVNlcnZpY2VdIFJlc3BvbnNlIGJvZHkgaXMgbnVsbCAoZ2VuZXJhdGVSYXcpLlwiKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVzcG9uc2UgYm9keSBpcyBudWxsIChnZW5lcmF0ZVJhdylcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuanNvbigpIGFzIE9sbGFtYUdlbmVyYXRlUmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc3QgY29ubmVjdGlvbkVycm9yTXNnID0gYEZhaWxlZCB0byBjb25uZWN0L2NvbW11bmljYXRlIHdpdGggT2xsYW1hIHNlcnZlciBhdCAke3RoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYVNlcnZlclVybH0uIElzIGl0IHJ1bm5pbmc/IChFbmRwb2ludDogL2FwaS9nZW5lcmF0ZSwgbm9uLXN0cmVhbWVkKWA7XG4gICAgICBpZiAoIWVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdPbGxhbWEgQVBJIGVycm9yJykpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKGBbT2xsYW1hU2VydmljZV0gQ29ubmVjdGlvbi9GZXRjaCBFcnJvciAoZ2VuZXJhdGVSYXcpOiAke2Nvbm5lY3Rpb25FcnJvck1zZ31gLCBlcnJvcik7XG4gICAgICAgIHRoaXMuZW1pdCgnY29ubmVjdGlvbi1lcnJvcicsIG5ldyBFcnJvcihjb25uZWN0aW9uRXJyb3JNc2cpKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlIHx8IGNvbm5lY3Rpb25FcnJvck1zZyk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2VuZXJhdGVFbWJlZGRpbmdzKHByb21wdHM6IHN0cmluZ1tdLCBtb2RlbDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXJbXVtdIHwgbnVsbD4ge1xuICAgIGlmICghcHJvbXB0cyB8fCBwcm9tcHRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuICAgIGNvbnN0IGVuZHBvaW50ID0gJy9hcGkvZW1iZWRkaW5ncyc7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hU2VydmVyVXJsfSR7ZW5kcG9pbnR9YDtcbiAgICBjb25zdCBoZWFkZXJzID0geyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH07XG4gICAgY29uc3QgZW1iZWRkaW5nc0xpc3Q6IG51bWJlcltdW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBmb3IgKGNvbnN0IHByb21wdCBvZiBwcm9tcHRzKSB7XG4gICAgICAgIGNvbnN0IHRyaW1tZWRQcm9tcHQgPSBwcm9tcHQudHJpbSgpO1xuICAgICAgICBpZiAoIXRyaW1tZWRQcm9tcHQpIGNvbnRpbnVlO1xuXG4gICAgICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0gSlNPTi5zdHJpbmdpZnkoeyBtb2RlbDogbW9kZWwsIHByb21wdDogdHJpbW1lZFByb21wdCB9KTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyBtZXRob2Q6ICdQT1NUJywgaGVhZGVycywgYm9keTogcmVxdWVzdEJvZHkgfSk7XG4gICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgICAgbGV0IGVycm9yVGV4dCA9IGBPbGxhbWEgRW1iZWRkaW5ncyBBUEkgZXJyb3IhIFN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YDtcbiAgICAgICAgICAgIHRyeSB7IGNvbnN0IGVyckpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7IGVycm9yVGV4dCArPSBgOiAke2Vyckpzb24/LmVycm9yIHx8ICdEZXRhaWxzIHVuYXZhaWxhYmxlJ31gOyB9IGNhdGNoIHt9XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIud2FybihgW09sbGFtYVNlcnZpY2VdIEVtYmVkZGluZ3MgQVBJIEVycm9yIGZvciBwcm9tcHQgXCIke3RyaW1tZWRQcm9tcHQuc3Vic3RyaW5nKDAsMzApfS4uLlwiOiAke2Vycm9yVGV4dH1gKTtcbiAgICAgICAgICAgIC8vINCf0YDQvtC00L7QstC20YPRlNC80L4g0Lcg0ZbQvdGI0LjQvNC4INC/0YDQvtC80L/RgtCw0LzQuFxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGVtYmVkZGluZ1Jlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2UuanNvbigpIGFzIE9sbGFtYUVtYmVkZGluZ3NSZXNwb25zZTtcbiAgICAgICAgICBpZiAoZW1iZWRkaW5nUmVzcG9uc2UgJiYgZW1iZWRkaW5nUmVzcG9uc2UuZW1iZWRkaW5nKSB7XG4gICAgICAgICAgICBlbWJlZGRpbmdzTGlzdC5wdXNoKGVtYmVkZGluZ1Jlc3BvbnNlLmVtYmVkZGluZyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIud2FybihgW09sbGFtYVNlcnZpY2VdIFZhbGlkIHJlc3BvbnNlIGJ1dCBubyBlbWJlZGRpbmcgZm91bmQgZm9yIHByb21wdCBcIiR7dHJpbW1lZFByb21wdC5zdWJzdHJpbmcoMCwzMCl9Li4uXCJgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKHNpbmdsZUVycm9yOiBhbnkpIHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoYFtPbGxhbWFTZXJ2aWNlXSBFcnJvciBnZW5lcmF0aW5nIGVtYmVkZGluZyBmb3IgcHJvbXB0IFwiJHt0cmltbWVkUHJvbXB0LnN1YnN0cmluZygwLDMwKX0uLi5cIjogJHtzaW5nbGVFcnJvci5tZXNzYWdlfWAsIHNpbmdsZUVycm9yKTtcbiAgICAgICAgICB0aGlzLmVtaXQoJ2Nvbm5lY3Rpb24tZXJyb3InLCBuZXcgRXJyb3Ioc2luZ2xlRXJyb3IubWVzc2FnZSB8fCAnRW1iZWRkaW5nIGdlbmVyYXRpb24gZmFpbGVkIGZvciBhIHByb21wdCcpKTtcbiAgICAgICAgICAvLyDQn9GA0L7QtNC+0LLQttGD0ZTQvNC+XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBlbWJlZGRpbmdzTGlzdC5sZW5ndGggPiAwID8gZW1iZWRkaW5nc0xpc3QgOiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vINCm0Y8g0LfQvtCy0L3RltGI0L3RjyDQv9C+0LzQuNC70LrQsCDQvNCw0LvQvtC50LzQvtCy0ZbRgNC90LAsINGP0LrRidC+INCy0L3Rg9GC0YDRltGI0L3RliDQvtCx0YDQvtCx0LvRj9GO0YLRjNGB0Y9cbiAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihgW09sbGFtYVNlcnZpY2VdIE91dGVyIGVycm9yIGluIGdlbmVyYXRlRW1iZWRkaW5nczogJHtlcnJvci5tZXNzYWdlfWAsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldE1vZGVscyhmb3JjZVJlZnJlc2g6IGJvb2xlYW4gPSBmYWxzZSk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICAvLyBgZm9yY2VSZWZyZXNoYCDRgtGD0YIg0L3QtSDQstC40LrQvtGA0LjRgdGC0L7QstGD0ZTRgtGM0YHRjywg0L7RgdC60ZbQu9GM0LrQuCDQvNC4INC90LUg0LrQtdGI0YPRlNC80L4g0YHQv9C40YHQvtC6INC80L7QtNC10LvQtdC5INCyINGG0YzQvtC80YMg0YHQtdGA0LLRltGB0ZYuXG4gICAgLy8g0K/QutGJ0L4g0LrQtdGI0YPQstCw0L3QvdGPINCx0YPQtNC1INC00L7QtNCw0L3Qviwg0YLQvtC00ZYgYGZvcmNlUmVmcmVzaGAg0YHRgtCw0L3QtSDQsNC60YLRg9Cw0LvRjNC90LjQvC5cbiAgICBjb25zdCBlbmRwb2ludCA9ICcvYXBpL3RhZ3MnO1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYVNlcnZlclVybH0ke2VuZHBvaW50fWA7XG4gICAgbGV0IG1vZGVsTGlzdFJlc3VsdDogc3RyaW5nW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyBtZXRob2Q6ICdHRVQnIH0pO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBsZXQgZXJyb3JUZXh0ID0gYE9sbGFtYSBUYWdzIEFQSSBlcnJvciEgU3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gO1xuICAgICAgICB0cnkgeyBjb25zdCBlcnJKc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOyBlcnJvclRleHQgKz0gYDogJHtlcnJKc29uPy5lcnJvciB8fCAnRGV0YWlscyB1bmF2YWlsYWJsZSd9YDsgfSBjYXRjaCB7fVxuICAgICAgICB0aGlzLnBsdWdpbi5sb2dnZXIuZXJyb3IoYFtPbGxhbWFTZXJ2aWNlXSBUYWdzIEFQSSBFcnJvcjogJHtlcnJvclRleHR9YCk7XG4gICAgICAgIHRoaXMuZW1pdCgnY29ubmVjdGlvbi1lcnJvcicsIG5ldyBFcnJvcihlcnJvclRleHQpKTtcbiAgICAgICAgLy8g0J/QvtCy0LXRgNGC0LDRlNC80L4g0L/QvtGA0L7QttC90ZbQuSDQvNCw0YHQuNCyINGDINCy0LjQv9Cw0LTQutGDINC/0L7QvNC40LvQutC4IEFQSSwg0YnQvtCxIFVJINC90LUgXCLQt9Cw0LLQuNGBXCJcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyB7IG1vZGVsczogQXJyYXk8e25hbWU6IHN0cmluZywgbW9kaWZpZWRfYXQ6IHN0cmluZywgc2l6ZTogbnVtYmVyLCBkaWdlc3Q6IHN0cmluZywgZGV0YWlsczogb2JqZWN0fT4gfTsgLy8g0JTQvtC00LDQsiDQsdGW0LvRjNGI0LUg0L/QvtC70ZbQsiDQtNC70Y8g0YLQuNC/0YNcbiAgICAgIGlmIChkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YS5tb2RlbHMpKSB7XG4gICAgICAgIG1vZGVsTGlzdFJlc3VsdCA9IGRhdGEubW9kZWxzXG4gICAgICAgICAgLm1hcCgobSkgPT4gbT8ubmFtZSlcbiAgICAgICAgICAuZmlsdGVyKChuYW1lKTogbmFtZSBpcyBzdHJpbmcgPT4gdHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnICYmIG5hbWUubGVuZ3RoID4gMClcbiAgICAgICAgICAuc29ydCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLndhcm4oXCJbT2xsYW1hU2VydmljZV0gUmVjZWl2ZWQgdW5leHBlY3RlZCBkYXRhIGZvcm1hdCBmcm9tIC9hcGkvdGFnc1wiLCBkYXRhKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25FcnJvck1zZyA9IGBGYWlsZWQgdG8gY29ubmVjdCBvciBmZXRjaCBtb2RlbHMgZnJvbSBPbGxhbWEgc2VydmVyIGF0ICR7dGhpcy5wbHVnaW4uc2V0dGluZ3Mub2xsYW1hU2VydmVyVXJsfS4gKEVuZHBvaW50OiAvYXBpL3RhZ3MpYDtcbiAgICAgIGlmICghZS5tZXNzYWdlPy5pbmNsdWRlcygnQVBJIGVycm9yJykpIHsgLy8gQXZvaWQgZHVwbGljYXRlIGVtaXRzXG4gICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihgW09sbGFtYVNlcnZpY2VdIENvbm5lY3Rpb24vRmV0Y2ggRXJyb3IgKGdldE1vZGVscyk6ICR7Y29ubmVjdGlvbkVycm9yTXNnfWAsIGUpO1xuICAgICAgICB0aGlzLmVtaXQoJ2Nvbm5lY3Rpb24tZXJyb3InLCBuZXcgRXJyb3IoZS5tZXNzYWdlIHx8IGNvbm5lY3Rpb25FcnJvck1zZykpO1xuICAgICAgfVxuICAgICAgLy8g0J/QvtCy0LXRgNGC0LDRlNC80L4g0L/QvtGA0L7QttC90ZbQuSDQvNCw0YHQuNCyLCDRidC+0LEgVUkg0LzRltCzINGG0LUg0L7QsdGA0L7QsdC40YLQuFxuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICByZXR1cm4gbW9kZWxMaXN0UmVzdWx0O1xuICB9XG5cblxuICBhc3luYyBnZXRNb2RlbERldGFpbHMobW9kZWxOYW1lOiBzdHJpbmcpOiBQcm9taXNlPE9sbGFtYVNob3dSZXNwb25zZSB8IG51bGw+IHtcbiAgICBjb25zdCBlbmRwb2ludCA9ICcvYXBpL3Nob3cnO1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYVNlcnZlclVybH0ke2VuZHBvaW50fWA7XG4gICAgY29uc3QgaGVhZGVycyA9IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9O1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwgeyBtZXRob2Q6ICdQT1NUJywgaGVhZGVycywgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lOiBtb2RlbE5hbWUgfSkgfSk7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGxldCBlcnJvclRleHQgPSBgT2xsYW1hIFNob3cgQVBJIGVycm9yIGZvciBtb2RlbCAke21vZGVsTmFtZX0hIFN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YDtcbiAgICAgICAgdHJ5IHsgY29uc3QgZXJySnNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsgZXJyb3JUZXh0ICs9IGA6ICR7ZXJySnNvbj8uZXJyb3IgfHwgJ0RldGFpbHMgdW5hdmFpbGFibGUnfWA7IH0gY2F0Y2gge31cbiAgICAgICAgdGhpcy5wbHVnaW4ubG9nZ2VyLmVycm9yKGBbT2xsYW1hU2VydmljZV0gU2hvdyBBUEkgRXJyb3I6ICR7ZXJyb3JUZXh0fWApO1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSA0MDQpIHsgLy8g0J3QtSDQtdC80ZbRgtGD0ZTQvNC+INC/0L7QvNC40LvQutGDINC3J9GU0LTQvdCw0L3QvdGPLCDRj9C60YnQviDRhtC1INC/0YDQvtGB0YLQviBcItC80L7QtNC10LvRjCDQvdC1INC30L3QsNC50LTQtdC90L5cIlxuICAgICAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0aW9uLWVycm9yJywgbmV3IEVycm9yKGVycm9yVGV4dCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsOyAvLyDQn9C+0LLQtdGA0YLQsNGU0LzQviBudWxsLCDRj9C60YnQviDQvNC+0LTQtdC70Ywg0L3QtSDQt9C90LDQudC00LXQvdC+INCw0LHQviDRltC90YjQsCDQv9C+0LzQuNC70LrQsFxuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKSBhcyBPbGxhbWFTaG93UmVzcG9uc2U7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25FcnJvck1zZyA9IGBGYWlsZWQgdG8gY29ubmVjdCBvciBnZXQgZGV0YWlscyBmb3IgbW9kZWwgJHttb2RlbE5hbWV9IGZyb20gT2xsYW1hIHNlcnZlciBhdCAke3RoaXMucGx1Z2luLnNldHRpbmdzLm9sbGFtYVNlcnZlclVybH0uIChFbmRwb2ludDogL2FwaS9zaG93KWA7XG4gICAgICBpZiAoIWUubWVzc2FnZT8uaW5jbHVkZXMoJ0FQSSBlcnJvcicpKSB7XG4gICAgICAgIHRoaXMucGx1Z2luLmxvZ2dlci5lcnJvcihgW09sbGFtYVNlcnZpY2VdIENvbm5lY3Rpb24vRmV0Y2ggRXJyb3IgKGdldE1vZGVsRGV0YWlscyk6ICR7Y29ubmVjdGlvbkVycm9yTXNnfWAsIGUpO1xuICAgICAgICB0aGlzLmVtaXQoJ2Nvbm5lY3Rpb24tZXJyb3InLCBuZXcgRXJyb3IoZS5tZXNzYWdlIHx8IGNvbm5lY3Rpb25FcnJvck1zZykpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbn0gLy8gLS0tIEVuZCBvZiBPbGxhbWFTZXJ2aWNlIGNsYXNzIC0tLSJdfQ==