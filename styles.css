/* ==========================================================================
   GLOBAL & VARIABLES
   ========================================================================== */

   :root {
    --chat-avatar-size: 30px; /* Avatar size */
    --chat-spacing-unit: 4px; /* Base spacing unit */
    --chat-message-max-width: 82%; /* Increased max message width */
  }


/* ==========================================================================
     MAIN LAYOUT & CONTAINERS
     ========================================================================== */

  .ollama-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    background-color: var(--background-secondary-alt); /* Background for the whole container */
  }

  .ollama-chat-container {
    flex: 1;
    overflow-y: auto;
    padding: calc(var(--chat-spacing-unit) * 4); /* 16px */
    padding-bottom: calc(var(--chat-spacing-unit) * 2); /* 8px */
    box-sizing: border-box;
    scroll-behavior: smooth;
    overscroll-behavior: contain;
    position: relative; /* For positioning new message indicator */
  }

  /* Scrollbar styling (Webkit browsers) */
  .ollama-chat-container::-webkit-scrollbar { width: 8px; }
  .ollama-chat-container::-webkit-scrollbar-track { background: var(--background-secondary); border-radius: 4px; margin: 4px 0; }
  .ollama-chat-container::-webkit-scrollbar-thumb { background-color: var(--background-modifier-border); border-radius: 4px; border: 2px solid var(--background-secondary); }
  .ollama-chat-container::-webkit-scrollbar-thumb:hover { background-color: var(--interactive-accent-translucent); }

  /* Ensure correct stretching within Obsidian */
  .workspace-leaf-content[data-type='ollama-chat-view'] { display: flex; flex-direction: column; }
  .workspace-leaf-content[data-type='ollama-chat-view'] .view-content { height: 100%; display: flex; flex-direction: column; overflow: hidden; }

  /* --- Date Separator --- */
  .chat-date-separator { text-align: center; margin: calc(var(--chat-spacing-unit) * 5) 0; font-size: 0.8em; color: var(--text-muted); font-weight: 500; background-color: var(--background-modifier-border); padding: calc(var(--chat-spacing-unit) * 0.5) calc(var(--chat-spacing-unit) * 2); border-radius: 10px; display: inline-block; margin-left: 50%; transform: translateX(-50%); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

  /* --- New Message Indicator --- */
  .new-message-indicator { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); background-color: var(--interactive-accent); color: var(--text-on-accent); padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 3); border-radius: 20px; font-size: 0.85em; font-weight: 500; cursor: pointer; box-shadow: 0 3px 8px rgba(var(--interactive-accent-rgb), 0.3); z-index: 15; opacity: 0; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; visibility: hidden; }
  .new-message-indicator.visible { opacity: 1; transform: translateX(-50%) translateY(0); visibility: visible; }
  .new-message-indicator:hover { background-color: var(--interactive-accent-hover); box-shadow: 0 4px 10px rgba(var(--interactive-accent-rgb), 0.4); }
  .new-message-indicator .indicator-icon { margin-right: 4px; vertical-align: middle; }


  /* Empty state styling */
  .ollama-empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; width: 100%; position: absolute; top: 0; left: 0; text-align: center; color: var(--text-muted); padding: 20px; box-sizing: border-box; z-index: 1; background-color: var(--background-secondary-alt); }
  .empty-state-message { font-size: 18px; margin-bottom: 10px; opacity: 0.7; }
  .empty-state-tip { font-size: 14px; opacity: 0.5; max-width: 80%; }


/* ==========================================================================
     CHAT INPUT SECTION
     ========================================================================== */

     .chat-input-container {
      /* ВИКОРИСТОВУЄМО FLEXBOX ДЛЯ ОСНОВНОГО КОНТЕЙНЕРА */
      display: flex;
      flex-direction: column; /* Тепер елементи йдуть зверху вниз */
      padding: calc(var(--chat-spacing-unit) * 2) calc(var(--chat-spacing-unit) * 3);
      border-top: 1px solid var(--divider-color);
      /* --- ЗМІНЕНО --- */
      background-color: var(--background-primary); /* Фон як у textarea */
      z-index: 20;
      border-radius: 12px;
      margin: calc(var(--chat-spacing-unit) * 2);
      margin-top: 0;
      box-sizing: border-box;
      /* box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1); */
      position: relative; /* Для позиціонування меню */
      transition: box-shadow 0.2s;
    }

    .chat-input-container:focus-within {
       /* Можна додати стиль для активного стану */
       /* box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1), 0 0 0 1px var(--background-modifier-border); */
       border-color: var(--interactive-accent); /* Приклад: зміна кольору рамки при фокусі */
    }
  
  
    /* --- Нова ліва зона для Model Display та Translate Button --- */
    .input-area-left {
        display: flex;
        flex-direction: column; /* Модель над кнопкою */
        align-items: center;
        justify-content: flex-end; /* Вирівнюємо кнопку по низу */
        padding-bottom: 4px; /* Невеликий відступ знизу для кнопки */
        gap: 4px; /* Проміжок між моделлю та кнопкою */
    }
  
    .model-display {
      font-size: var(--font-ui-smaller);
      color: var(--text-muted);
      padding: 4px 8px; /* Збільшено горизонтальний паддінг */
      border-radius: var(--radius-s);
      cursor: pointer;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px; /* Можна збільшити */
      border: 1px solid transparent;
      /* --- ЗМІНЕНО --- */
      background-color: var(--background-primary); /* Фон як у textarea */
      transition: all 0.2s ease;
    }
    .model-display:hover {
      /* --- МОЖЛИВО ПОТРІБНО НАЛАШТУВАТИ --- */
      /* Якщо --background-primary = --background-modifier-hover, hover не буде видно */
      /* Можливо, краще var(--background-secondary) або var(--background-modifier-border) */
      background-color: var(--background-modifier-hover); /* Залишаємо поки що, але майте на увазі */
      border-color: var(--background-modifier-border);
      color: var(--text-normal);
    }

  
    /* Кнопка перекладу в лівій групі */
    .input-controls-left .translate-input-button {
      width: 28px; /* Трохи менша */
      height: 28px;
      border: none;
      border-radius: var(--radius-s); /* Не кругла */
      background-color: transparent;
      color: var(--text-muted);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center; padding: 0; transition: all 0.15s ease-in-out; opacity: 0.7; outline: none; flex-shrink: 0;
 }
  .input-controls-left .translate-input-button:hover {
      background-color: var(--background-modifier-hover);
      color: var(--text-normal);
      opacity: 1;
      transform: scale(1.05);
  }
  /* Стиль завантаження */
  .input-controls-left .translate-input-button.translating-input .svg-icon { animation: spin 1s linear infinite; }
  .input-controls-left .translate-input-button.translating-input { cursor: default; opacity: 0.5; }
 /* --- Кінець лівої групи --- */

  /* --- Права група кнопок (старий buttonsContainer) --- */
  .input-controls-right {
    /* Видалено position: absolute */
    display: flex;
    align-items: center; /* Вирівнюємо кнопки */
    gap: calc(var(--chat-spacing-unit) * 1.5); /* Проміжок між кнопками */
    flex-shrink: 0;
  }
  /* Базовий стиль кнопок (Send, Voice, Menu) */
  .input-controls-right button {
    width: 32px; height: 32px; border: none; border-radius: 50%; background-color: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0; transition: all 0.15s ease-in-out; opacity: 0.7; outline: none; flex-shrink: 0;
   }
   .input-controls-right button:hover { background-color: var(--background-modifier-hover); color: var(--text-normal); opacity: 1; transform: scale(1.05); }
   .input-controls-right button.disabled { opacity: 0.4 !important; cursor: not-allowed; background-color: transparent !important; transform: none !important; box-shadow: none !important; }
   /* Специфічні стилі для Send, Voice */
   .input-controls-right .send-button { /* ... (стилі без змін) ... */ }
   .input-controls-right .voice-button.recording { /* ... (стилі без змін) ... */ }
   /* --- Кінець правої групи --- */

    .input-area-left .translate-input-button {
         /* Успадковує базові стилі .buttons-container button, але тут ми його винесли */
         width: 30px; /* Розмір як у інших кнопок */
         height: 30px;
         border: none;
         border-radius: 50%;
         background-color: transparent;
         color: var(--text-muted);
         cursor: pointer;
         display: flex;
         align-items: center;
         justify-content: center;
         padding: 0;
         transition: all 0.15s ease-in-out;
         opacity: 0.7;
         outline: none;
         flex-shrink: 0;
         margin: 0; /* Прибираємо зайві відступи */
    }
     .input-area-left .translate-input-button:hover {
         background-color: var(--background-modifier-hover);
         color: var(--text-normal);
         opacity: 1;
         transform: scale(1.05);
     }
     /* Стиль завантаження для кнопки перекладу */
     .input-area-left .translate-input-button.translating-input .svg-icon {
         animation: spin 1s linear infinite;
     }
     .input-area-left .translate-input-button.translating-input {
         cursor: default;
         opacity: 0.5;
     }
    /* --- Кінець лівої зони --- */
  

    .chat-input-container textarea {
      flex: 1; /* Не потрібен, бо контейнер column */
      width: 100%; /* Займає всю ширину */
      resize: none; 
      border: none; 
      border-radius: 8px;
      padding: 10px 15px;
      padding-right: 15px; /* Скидаємо великий правий відступ */
      min-height: 40px; max-height: 50vh; 
      background-color: var(--background-primary); 
      color: var(--text-normal); font-size: 14px; line-height: 1.5; 
      transition: border-color 0.3s, box-shadow 0.3s, height 0.15s ease-out; overflow-y: auto; 
      /* box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);  */
      margin-bottom: calc(var(--chat-spacing-unit) * 2); /* Відступ між textarea та контролами */
      box-sizing: border-box; 
    }
    .chat-input-container textarea:focus { 
      outline: none; 
      /* box-shadow: inset 0 1px 2px rgba(0,0,0,0.05), 0 0 0 2px var(--interactive-accent-translucent);  */
      border-color: var(--interactive-accent); /* Наприклад, якщо у textarea є border */
      background-color: var(--background-secondary); /* Ледь помітна зміна фону при фокусі */

    }
       
    .input-controls-container {
      display: flex;
      justify-content: space-between; /* Розносимо ліву та праву групи */
      align-items: center; /* Вирівнюємо по вертикалі */
      width: 100%;
  }

  .input-controls-left {
    display: flex;
    align-items: center; /* Вирівнюємо по центру */
    gap: 6px; /* Проміжок */
    flex-shrink: 0; /* Не стискати */
}


    .buttons-container {
      /* Видалено position: absolute */
      display: flex;
      align-items: flex-end; /* Вирівнюємо по низу з textarea */
      padding-bottom: 4px; /* Невеликий відступ, щоб кнопки були на рівні тексту */
      gap: calc(var(--chat-spacing-unit) * 1.5); /* Проміжок між кнопками */
    }
    /* Базовий стиль кнопок (Send, Voice, Menu) */
    .buttons-container button {
      width: 32px; height: 32px; border: none; border-radius: 50%; background-color: transparent; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0; transition: all 0.15s ease-in-out; opacity: 0.7; outline: none; flex-shrink: 0;
     }
     .buttons-container button:hover { background-color: var(--background-modifier-hover); color: var(--text-normal); opacity: 1; transform: scale(1.05); }
     .buttons-container button.disabled { opacity: 0.4 !important; cursor: not-allowed; background-color: transparent !important; transform: none !important; box-shadow: none !important; }

  .buttons-container button:focus-visible { opacity: 1; background-color: var(--background-modifier-hover); box-shadow: 0 0 0 2px var(--interactive-accent-translucent); }


  /* Send Button */
  .buttons-container .send-button { background-color: var(--interactive-accent); color: var(--text-on-accent); opacity: 1; box-shadow: 0 1px 3px rgba(var(--interactive-accent-rgb), 0.2); }
  .buttons-container .send-button:hover { background-color: var(--interactive-accent-hover); transform: scale(1.08); box-shadow: 0 2px 6px rgba(var(--interactive-accent-rgb), 0.3); }
  .buttons-container .send-button:active { transform: scale(1.02); background-color: var(--interactive-accent); }
  .buttons-container .send-button.disabled { background-color: var(--background-modifier-border) !important; color: var(--text-muted) !important; opacity: 0.6 !important; box-shadow: none !important; }

  /* Voice Button */
  .buttons-container .voice-button.recording { background-color: var(--text-error); color: white; opacity: 1; animation: pulse-recording 1.5s infinite ease-in-out; box-shadow: 0 0 0 0 rgba(var(--text-error-rgb), 0.5); }
  @keyframes pulse-recording { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--text-error-rgb), 0.5); } 70% { transform: scale(1.05); box-shadow: 0 0 0 6px rgba(var(--text-error-rgb), 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--text-error-rgb), 0); } }

  /* --- NEW: Translate Input Button --- */
  /* .buttons-container .translate-input-button {
   
  } */
  /* Loading state for input translate button */
  .buttons-container .translate-input-button.translating-input .svg-icon {
    animation: spin 1s linear infinite; /* Reuse spin animation */
  }
  .buttons-container .translate-input-button.translating-input {
      cursor: default;
      opacity: 0.5; /* Reduce opacity while loading */
  }
  /* ----------------------------------- */

  /* Menu Button */
  /* .buttons-container .menu-button {
  } */


/* ==========================================================================
     REGULAR MESSAGE STYLING
     ========================================================================== */

  /* Message appear animation */
  @keyframes message-appear { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
  .message.message-arriving { animation: message-appear 0.3s ease-out forwards; }

  .ollama-chat-container .message-group { display: flex; flex-direction: column; width: 100%; margin-bottom: calc(var(--chat-spacing-unit) * 4); /* Increased spacing */ position: relative; padding-left: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2); padding-right: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2); box-sizing: border-box; /* Ensure padding is included in width */ }
  .ollama-chat-container .user-message-group { align-items: flex-end; }
  .ollama-chat-container .ollama-message-group { align-items: flex-start; }

  /* Avatars */
  .message-group-avatar { position: absolute; bottom: calc(var(--chat-spacing-unit) * 2.5); width: var(--chat-avatar-size); height: var(--chat-avatar-size); border-radius: 50%; background-color: var(--background-modifier-hover); color: var(--text-muted); font-size: calc(var(--chat-avatar-size) * 0.5); display: flex; align-items: center; justify-content: center; font-weight: 600; box-shadow: 0 1px 2px rgba(0,0,0,0.1); z-index: 5; /* Ensure avatar is above message bg */ }
  .ollama-message-group .message-group-avatar { left: 0; }
  .user-message-group .message-group-avatar { right: 0; background-color: var(--interactive-accent-translucent); color: var(--interactive-accent); }
  .message-group-avatar .svg-icon { width: 60%; height: 60%; } /* Adjust icon size within avatar */


  .ollama-chat-container .message { margin-bottom: calc(var(--chat-spacing-unit) * 1); /* Small gap between messages in group */ padding: calc(var(--chat-spacing-unit) * 2) calc(var(--chat-spacing-unit) * 3); border-radius: 18px; max-width: var(--chat-message-max-width); word-wrap: break-word; position: relative; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08); font-size: var(--font-ui-small); line-height: 1.5; transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; }

  /* Consecutive messages styling */
  .user-message-group .message:not(:last-child) { border-bottom-right-radius: 5px; }
  .ollama-message-group .message:not(:last-child) { border-bottom-left-radius: 5px; }
  .message-group .message:not(:first-child) { margin-top: calc(var(--chat-spacing-unit) * 1); } /* Space between consecutive bubbles */


  /* User messages */
  .ollama-chat-container .user-message { background-color: var(--interactive-accent); background-image: linear-gradient(135deg, var(--interactive-accent) 0%, var(--interactive-accent-hover) 100%); color: var(--text-on-accent); align-self: flex-end; border-top-left-radius: 18px; border-bottom-left-radius: 18px; border-top-right-radius: 18px; border-bottom-right-radius: 5px; box-shadow: 0 1px 4px rgba(var(--interactive-accent-rgb), 0.2); }
  .ollama-chat-container .user-message-group .message:last-child.user-message { border-bottom-right-radius: 18px; }
  .ollama-chat-container .user-message:hover { box-shadow: 0 3px 7px rgba(var(--interactive-accent-rgb), 0.3); transform: translateY(-1px) scale(1.01); }


  /* AI messages */
  .ollama-chat-container .ollama-message { background-color: var(--background-primary); color: var(--text-normal); align-self: flex-start; border-top-right-radius: 18px; border-bottom-right-radius: 18px; border-top-left-radius: 18px; border-bottom-left-radius: 5px; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06); }
  .ollama-chat-container .ollama-message-group .message:last-child.ollama-message { border-bottom-left-radius: 18px; }
  .ollama-chat-container .ollama-message:hover { box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1); transform: translateY(-1px) scale(1.01); }

  /* Message Content & Meta */
  .message-content-container { position: relative; /* Needed for absolute positioning of buttons */ width: 100%; }
  .message-content { padding-bottom: calc(var(--chat-spacing-unit) * 2); /* Space below text before timestamp/translation */ box-sizing: border-box; width: 100%; /* Ensure it spans width for padding */ }
  .message-timestamp { font-size: 0.75em; color: var(--text-faint); margin-top: var(--chat-spacing-unit); text-align: right; display: block; width: 100%; opacity: 0.9; clear: both; /* Ensure it doesn't overlap floated elements */ }
  .user-message .message-timestamp { color: var(--text-on-accent); opacity: 0.75; }


/* ==========================================================================
     SYSTEM & ERROR MESSAGES
     ========================================================================== */

  .system-message-group { display: flex; flex-direction: column; align-items: center; margin: calc(var(--chat-spacing-unit) * 4) 0; }
  .system-message { background: var(--background-secondary); color: var(--text-muted); border-left: 3px solid var(--interactive-accent); font-style: italic; padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 2.5); border-radius: 8px; max-width: 90%; display: flex !important; align-items: center !important; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important; position: relative; font-size: 0.9em; }
  .system-icon { color: var(--interactive-accent); margin-right: 8px; font-size: 1em; flex-shrink: 0; }
  .system-message-text { line-height: 1.4; }

  .error-message-group { margin: calc(var(--chat-spacing-unit) * 4) 0 !important; display: flex; flex-direction: column; align-items: center; }
  .error-message { background: var(--background-modifier-error) !important; color: var(--text-on-error) !important; border-left: 3px solid var(--text-error) !important; font-weight: 500 !important; padding: calc(var(--chat-spacing-unit) * 2) calc(var(--chat-spacing-unit) * 3) !important; max-width: 90% !important; position: relative; box-shadow: 0 2px 6px rgba(var(--text-error-rgb), 0.2) !important; border-radius: 8px !important; display: flex !important; align-items: center !important; font-size: 0.95em !important; }
  .error-icon { color: var(--text-error) !important; margin-right: 10px !important; font-size: 1.1em !important; flex-shrink: 0; }
  .error-message-text { line-height: 1.4 !important; color: var(--text-on-error) !important; font-weight: normal !important; }
  @keyframes error-pulse { 0% { box-shadow: 0 2px 6px rgba(var(--text-error-rgb), 0.2); } 50% { box-shadow: 0 3px 10px 2px rgba(var(--text-error-rgb), 0.35); } 100% { box-shadow: 0 2px 6px rgba(var(--text-error-rgb), 0.2); } }
  .error-message-group:last-child .error-message { animation: error-pulse 1.5s ease-out 1 !important; }


/* ==========================================================================
     ACTION BUTTONS (Copy, Translate) in Messages
     ========================================================================== */
     .message-actions-wrapper {
      display: flex;
      gap: calc(var(--chat-spacing-unit) * 1.5); /* Space between buttons */
      position: absolute;
      top: calc(var(--chat-spacing-unit) * 1);
      right: calc(var(--chat-spacing-unit) * 1.5);
      opacity: 0; /* Приховано за замовчуванням на десктопі */
      visibility: hidden;
      transition: opacity 0.2s ease-in-out, visibility 0s 0.2s;
      z-index: 2;
    }

  /* Show buttons on hover over the message bubble */
  .message:hover .message-actions-wrapper {
    opacity: 1;
    visibility: visible;
    transition-delay: 0s; /* Show immediately on hover */
  }

  .message-actions-wrapper button {
    padding: calc(var(--chat-spacing-unit) * 0.5) calc(var(--chat-spacing-unit) * 1);
    background-color: var(--background-modifier-hover);
    border: 1px solid var(--background-modifier-border);
    border-radius: var(--radius-s);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    transition: all 0.15s ease-out;
    outline: none;
    line-height: 1; /* Для кращого вирівнювання іконки */
  }

  .message-actions-wrapper button:hover {
    background-color: var(--background-modifier-border);
    color: var(--text-normal);
    transform: scale(1.05);
   }

  /* Adjust icon size within buttons */
  .message-actions-wrapper button .svg-icon {
      width: 14px;
      height: 14px;
  }

  /* Specific styles for user message buttons (different background) */
  .user-message .message-actions-wrapper button {
    background-color: rgba(255, 255, 255, 0.15); border-color: rgba(255, 255, 255, 0.2); color: var(--text-on-accent); opacity: 0.7;
 }
 .user-message .message-actions-wrapper button:hover {
    background-color: rgba(255, 255, 255, 0.25); border-color: rgba(255, 255, 255, 0.3); opacity: 1;
 }
 .translate-button.translation-pending .svg-icon { animation: spin 1s linear infinite; }
 .translate-button.translation-pending { cursor: default; opacity: 0.6 !important; }
 @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

/* ==========================================================================
     TRANSLATION DISPLAY
     ========================================================================== */
  .translation-container {
    border-top: 1px dashed var(--background-modifier-border); /* Separator line */
    margin-top: calc(var(--chat-spacing-unit) * 2);
    padding-top: calc(var(--chat-spacing-unit) * 1.5);
    font-size: 0.95em; /* Slightly smaller text than original */
    color: var(--text-muted); /* Muted color for translation */
  }
   /* Adjust color for user messages */
  .user-message .translation-container {
      border-top-color: rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.85);
  }

  /* Style for the translation text itself */
  .translation-content {
    white-space: pre-wrap; /* Preserve line breaks from translation */
    line-height: 1.45;
  }

  /* Optional indicator for the target language */
  .translation-indicator {
      font-size: 0.8em;
      font-style: italic;
      margin-top: calc(var(--chat-spacing-unit) * 1);
      text-align: right;
      opacity: 0.7;
  }
   /* Adjust color for user messages */
  .user-message .translation-indicator {
       opacity: 0.6;
  }


/* ==========================================================================
     LOADING & THINKING INDICATORS
     ========================================================================== */

  /* Loading dots shown when waiting for AI response */
  .thinking-dots { display: flex; align-items: center; justify-content: center; padding: 8px 0; }
  .thinking-dot { width: 7px; height: 7px; border-radius: 50%; background-color: var(--text-muted); margin: 0 3px; opacity: 0.6; animation: dot-pulse 1.4s infinite ease-in-out; }
  .thinking-dot:nth-child(1) { animation-delay: 0s; } .thinking-dot:nth-child(2) { animation-delay: 0.2s; } .thinking-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes dot-pulse { 0%, 80%, 100% { transform: scale(0.8); opacity: 0.4; } 40% { transform: scale(1.2); opacity: 1; } }

  /* Styling for <think> tag content */
  .thinking-block { border: 1px solid var(--background-modifier-border); border-radius: 6px; margin: 10px 0; background-color: var(--background-secondary-alt); overflow: hidden; }
  .thinking-header { background-color: var(--background-modifier-hover); color: var(--text-muted); padding: 6px 10px; display: flex; align-items: center; cursor: pointer; user-select: none; transition: background-color 0.2s; }
  .thinking-header:hover { background-color: var(--background-modifier-border); }
  .thinking-toggle { margin-right: 6px; font-weight: bold; transition: transform 0.2s ease-in-out; font-size: 0.9em; }
  .thinking-header[data-fold-state="expanded"] .thinking-toggle { transform: rotate(90deg); }
  .thinking-title { font-weight: 500; font-size: 0.9em; }
  .thinking-content { padding: 10px 12px; white-space: pre-wrap; overflow-x: auto; line-height: 1.5; border-top: 1px solid var(--background-modifier-border); background-color: var(--background-primary); font-size: 0.9em; color: var(--text-normal); }
  .thinking-content pre { background-color: var(--background-secondary) !important; } .thinking-content code { background-color: var(--background-modifier-hover) !important; }


/* ==========================================================================
     MARKDOWN CONTENT IN MESSAGES
     ========================================================================== */

  .ollama-message .message-content { width: 100%; /* Ensure content takes full width before padding */ box-sizing: border-box; /* Include padding in width */ }
  .ollama-message .message-content > *:first-child { margin-top: 0; }
  .ollama-message .message-content > *:last-child:not(.translation-container) { margin-bottom: 0; /* Don't add margin below last real content item */ }
  .ollama-message .message-content p { margin: 0.6em 0; line-height: 1.55; }
  .ollama-message .message-content ul, .ollama-message .message-content ol { margin: 0.6em 0; padding-left: 1.8em; }
  .ollama-message .message-content li { margin-bottom: 0.3em; }

  /* Enhanced code blocks */
  .ollama-message .message-content pre { background-color: var(--background-secondary); border-radius: 6px; margin: 0.8em 0; border: 1px solid var(--background-modifier-border); font-size: 0.9em; position: relative; padding: 0; }
  .ollama-message .message-content pre > code { display: block; padding: 12px; padding-top: 20px; padding-bottom: 28px; overflow-x: auto; background-color: transparent !important; border-radius: 0; }
  .code-block-language { position: absolute; top: 0; right: 10px; font-size: 0.75em; color: var(--text-faint); padding: 2px 5px; background-color: var(--background-modifier-hover); border-radius: 0 0 4px 4px; z-index: 1; }
  .code-block-copy-button { position: absolute; bottom: 6px; right: 6px; background-color: var(--background-modifier-hover) !important; color: var(--text-muted) !important; border: 1px solid var(--background-modifier-border) !important; border-radius: 4px; padding: 3px 5px !important; font-size: 0.8em !important; line-height: 1; cursor: pointer; opacity: 0.6; transition: all 0.2s ease; z-index: 1; }
  .code-block-copy-button:hover { opacity: 1; background-color: var(--background-modifier-border) !important; color: var(--text-normal) !important; }

  /* Inline code */
  .ollama-message .message-content p code,
  .ollama-message .message-content li code { font-family: var(--font-monospace); font-size: 0.9em; background-color: var(--background-modifier-hover); padding: 0.2em 0.4em; border-radius: 4px; word-break: break-word; }

  /* Blockquotes */
  .ollama-message .message-content blockquote { border-left: 3px solid var(--interactive-accent); margin: 0.8em 0; padding: 0.5em 1.2em; color: var(--text-muted); background-color: var(--background-secondary-alt); border-radius: 0 6px 6px 0; }
  .ollama-message .message-content blockquote p { margin: 0.4em 0; }

  /* Links */
  .ollama-message .message-content a,
  .thinking-content a { color: var(--text-accent); text-decoration: none; border-bottom: 1px solid var(--text-accent-translucent); transition: color 0.2s, border-color 0.2s; }
  .ollama-message .message-content a:hover,
  .thinking-content a:hover { color: var(--text-accent-hover); border-bottom-color: var(--text-accent-hover); }


/* ==========================================================================
     MENU DROPDOWN
     ========================================================================== */

  .menu-dropdown.ollama-chat-menu { /* Target specific menu */
      position: absolute; 

      right: calc(var(--chat-spacing-unit) * 1); /* Ближче до правої кнопки */
      bottom: calc(100% + var(--chat-spacing-unit)); /* Над полем контролів */

      background-color: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); z-index: 100; min-width: 220px; /* Slightly wider */ 
      overflow: hidden; animation: menu-fade-in 0.15s ease-out; padding: calc(var(--chat-spacing-unit) * 1) 0; display: flex; flex-direction: column;
  }



  .ollama-chat-menu .model-submenu-section {
    /* Поки що без змін, але ми додамо приховування на десктопі */
 }

  @keyframes menu-fade-in { from { opacity: 0; transform: translateY(5px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

  /* General style for all menu options within this specific menu */
  .ollama-chat-menu .menu-option { display: flex; align-items: center; padding: calc(var(--chat-spacing-unit) * 2) calc(var(--chat-spacing-unit) * 3); cursor: pointer; transition: background-color 0.15s ease-out; color: var(--text-normal); margin: 0 calc(var(--chat-spacing-unit) * 1); border-radius: 5px; }
  .ollama-chat-menu .menu-option:hover { background-color: var(--background-modifier-hover); }
  .ollama-chat-menu .menu-option-icon { margin-right: 12px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); flex-shrink: 0; min-width: 18px; font-size: 1em; }
  .ollama-chat-menu .menu-option-text { font-size: var(--font-ui-small); line-height: 1.3; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; }

  /* Menu Separator */
  .ollama-chat-menu .menu-separator { height: 1px; background-color: var(--background-modifier-border); margin: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 1); }

  /* Section Header in Menu */
  .ollama-chat-menu .menu-header { padding: 8px 12px 4px 12px; font-size: 0.8em; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

  /* Container for scrollable lists (Models, Roles, Chats) */
  .ollama-chat-menu .model-list-container,
  .ollama-chat-menu .role-list-container,
  .ollama-chat-menu .chat-list-container { /* Added .chat-list-container */
      max-height: 200px; /* Adjusted height */
      overflow-y: auto; /* Add scrollbar if needed */
      margin-bottom: 4px;
      padding: 0 4px; /* Padding for scrollbar */
      border: 1px solid transparent;
  }
   /* Scrollbar styling for lists */
  .ollama-chat-menu .model-list-container::-webkit-scrollbar,
  .ollama-chat-menu .role-list-container::-webkit-scrollbar,
  .ollama-chat-menu .chat-list-container::-webkit-scrollbar { width: 6px; } /* Added .chat-list-container */
  .ollama-chat-menu .model-list-container::-webkit-scrollbar-track,
  .ollama-chat-menu .role-list-container::-webkit-scrollbar-track,
  .ollama-chat-menu .chat-list-container::-webkit-scrollbar-track { background: transparent; margin: 4px 0; } /* Added .chat-list-container */
  .ollama-chat-menu .model-list-container::-webkit-scrollbar-thumb,
  .ollama-chat-menu .role-list-container::-webkit-scrollbar-thumb,
  .ollama-chat-menu .chat-list-container::-webkit-scrollbar-thumb { background-color: var(--background-modifier-border); border-radius: 3px; } /* Added .chat-list-container */
  .ollama-chat-menu .model-list-container::-webkit-scrollbar-thumb:hover,
  .ollama-chat-menu .role-list-container::-webkit-scrollbar-thumb:hover,
  .ollama-chat-menu .chat-list-container::-webkit-scrollbar-thumb:hover { background-color: var(--interactive-accent-translucent); } /* Added .chat-list-container */

  /* Text for Loading/Error/Empty states in lists */
  .ollama-chat-menu .model-list-container span,
  .ollama-chat-menu .role-list-container span,
  .ollama-chat-menu .chat-list-container span { display: block; padding: 8px 12px; font-size: var(--font-ui-small); color: var(--text-muted); font-style: italic; } /* Added .chat-list-container */

  /* Styling for individual Model, Role and Chat options */
  .ollama-chat-menu .model-option,
  .ollama-chat-menu .role-option,
  .ollama-chat-menu .chat-option { /* Added .chat-option */
       padding-top: 5px;    /* Adjusted vertical padding */
       padding-bottom: 5px; /* Adjusted vertical padding */
       margin-top: 1px;
       margin-bottom: 1px;
       display: flex; align-items: center; cursor: pointer; transition: background-color 0.15s ease-out; color: var(--text-normal); border-radius: 5px;
       padding-left: calc(var(--chat-spacing-unit) * 3);
       padding-right: calc(var(--chat-spacing-unit) * 3);
       margin-left: calc(var(--chat-spacing-unit) * 1);
       margin-right: calc(var(--chat-spacing-unit) * 1);
  }
  .ollama-chat-menu .model-option .menu-option-icon,
  .ollama-chat-menu .role-option .menu-option-icon,
  .ollama-chat-menu .chat-option .menu-option-icon { /* Added .chat-option */
       margin-right: 12px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); flex-shrink: 0; min-width: 18px; font-size: 1em;
  }
  .ollama-chat-menu .model-option .menu-option-icon .svg-icon,
  .ollama-chat-menu .role-option .menu-option-icon .svg-icon,
  .ollama-chat-menu .chat-option .menu-option-icon .svg-icon { /* Added .chat-option */
       width: 16px; height: 16px; /* Icon size */
  }
  /* Styling for the selected item */
  .ollama-chat-menu .model-option.is-selected .menu-option-text,
  .ollama-chat-menu .role-option.is-selected .menu-option-text,
  .ollama-chat-menu .chat-option.is-selected .menu-option-text { /* Added .chat-option */
       font-weight: 600;
       color: var(--text-normal);
  }
   .ollama-chat-menu .chat-option.is-selected { /* Style for selected chat */
        background-color: var(--background-modifier-hover); /* Light background */
   }
  .ollama-chat-menu .model-option.is-selected .menu-option-icon,
  .ollama-chat-menu .role-option.is-selected .menu-option-icon,
  .ollama-chat-menu .chat-option.is-selected .menu-option-icon { /* Added .chat-option */
        color: var(--interactive-accent);
  }
   /* Style for icon indicating a custom role (if needed, requires class added in TS) */
  .ollama-chat-menu .role-option.is-custom .menu-option-icon:not(:has(.svg-icon[icon-name="check"])) { color: var(--text-faint); /* Example: make default icon faint */ }

  /* Styles for text within chat option (name + date) */
  .ollama-chat-menu .chat-option .menu-option-text {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
      flex-grow: 1;
      overflow: hidden; /* Clip overflowing text */
  }
  .ollama-chat-menu .chat-option .chat-option-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis; /* Add ellipsis for long names */
      font-size: var(--font-ui-small);
      margin-bottom: 2px;
  }
  .ollama-chat-menu .chat-option .chat-option-date {
      font-size: 0.8em;
      color: var(--text-faint);
      white-space: nowrap;
  }

  /* Info/Error text styling within menu lists */
  .ollama-chat-menu .menu-info-text {
      padding: 8px 12px;
      font-style: italic;
      color: var(--text-muted);
      font-size: 0.85em;
  }
   .ollama-chat-menu .menu-error-text {
      padding: 8px 12px;
      color: var(--text-error);
      font-style: italic;
      font-size: 0.85em;
  }


/* ==========================================================================
   STYLES FOR LONG MESSAGE COLLAPSING
   ========================================================================== */

.message-content-collapsible { transition: max-height 0.3s ease-out; overflow: hidden; position: relative; }
.message-content-collapsed { /* max-height is set via JS */ -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%); mask-image: linear-gradient(to bottom, black 80%, transparent 100%); }
.show-more-button { display: block; margin: 8px auto 0 auto; padding: 4px 12px; font-size: 0.85em; color: var(--text-accent); background-color: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 15px; cursor: pointer; transition: all 0.2s ease; text-align: center; }
.show-more-button:hover { background-color: var(--background-modifier-hover); border-color: var(--interactive-accent-translucent); color: var(--text-accent-hover); }


.ollama-chat-menu .menu-header-item { /* Клікабельний заголовок */
  /* ... (стилі з попередньої відповіді) ... */
}
.ollama-chat-menu .submenu-icon { /* Іконка стрілки */
  /* ... (стилі з попередньої відповіді) ... */
}
.ollama-chat-menu .submenu-content { /* Контейнер списку */
  max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, padding 0.3s ease-out; padding: 0 calc(var(--chat-spacing-unit) * 1); margin: 0 calc(var(--chat-spacing-unit) * 1); border-left: 2px solid var(--background-modifier-border-hover); margin-left: calc(var(--chat-spacing-unit) * 3); padding-left: calc(var(--chat-spacing-unit) * 2); margin-bottom: calc(var(--chat-spacing-unit) * 1);
}
.ollama-chat-menu .submenu-content-hidden { max-height: 0 !important; padding-top: 0 !important; padding-bottom: 0 !important; border-left-color: transparent; margin-bottom: 0; }
.ollama-chat-menu .submenu-content .menu-option { /* Елементи всередині акордеону */
  padding-left: calc(var(--chat-spacing-unit) * 2) !important; margin-left: 0 !important; margin-right: 0 !important; width: auto;
}

/* ==========================================================================
     RESPONSIVE DESIGN
     ========================================================================== */
.ollama-chat-menu .menu-option.danger-option:hover {
  background-color: var(--background-modifier-error-hover);
    color: var(--text-on-error);
}
.ollama-chat-menu .menu-option.danger-option:hover .menu-option-icon {
  color: var(--text-on-error); 
}
@media (hover: hover) and (pointer: fine) {
  .message:hover .message-actions-wrapper {
    opacity: 1;
    visibility: visible;
    transition-delay: 0s;
  }
}

@media screen and (max-width: 768px) { /* поріг для планшетів */
  :root {
      --chat-message-max-width: 90%; /* Трохи ширші повідомлення */
      --chat-avatar-size: 28px; /* Трохи менший аватар */
  }
  .ollama-chat-container {
      padding: calc(var(--chat-spacing-unit) * 3); /* Менші відступи контейнера */
      padding-bottom: calc(var(--chat-spacing-unit) * 1.5);
  }
  .message-group {
      padding-left: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2);
      padding-right: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2);
      margin-bottom: calc(var(--chat-spacing-unit) * 3); /* Менший відступ між групами */
  }
  .ollama-chat-container .message {
      padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 2.5); /* Менші відступи в бульбашці */
      font-size: calc(var(--font-ui-small) * 0.98); /* Трохи менший шрифт */
  }
   /* Кнопки дій на повідомленнях - робимо видимими */
   .message-actions-wrapper {
      opacity: 0.6; /* Напівпрозорі */
      visibility: visible;
      transition: none; /* Прибираємо transition */
   }
    .message-actions-wrapper button {
        background-color: transparent; /* Прозоріший фон */
        border: none;
        padding: 1px; /* Менший паддінг */
    }
    .message-actions-wrapper button .svg-icon {
        width: 13px; height: 13px; /* Менша іконка */
    }
     .user-message .message-actions-wrapper button {
         background-color: transparent; border: none; opacity: 0.7;
     }
     .message-actions-wrapper button:hover { /* Ефект при наведенні/натисканні */
        background-color: var(--background-modifier-hover);
        transform: scale(1.1);
     }
      .user-message .message-actions-wrapper button:hover {
          background-color: rgba(255, 255, 255, 0.2) !important;
      }

      .chat-input-container { 
        gap: 6px; 
        flex-direction: column;
      }
      .input-controls-container { /* Контроли в один ряд */
        flex-wrap: wrap; /* Дозволяємо перенос, якщо не влазить */
        justify-content: center; /* Центруємо групи на малих екранах */
        gap: 8px;
     }
     .input-area-left { /* Показуємо модель/переклад знову (можливо, поруч?) */
         /* display: flex; */ /* Розкоментуйте, якщо хочете їх показувати */
         order: 1; /* Ліва група */
         flex-grow: 1; /* Дозволяємо рости */
         justify-content: flex-start; /* Вирівнюємо по лівому краю */
     }
     .input-controls-right { /* Права група */
         order: 2;
         flex-grow: 1; /* Дозволяємо рости */
         justify-content: flex-end; /* Вирівнюємо по правому краю */
     }
      .chat-input-container textarea { 
        padding-left: 10px; 
        margin-bottom: 6px; /* Менший відступ */
        padding-right: 15px; /* Скидаємо великий відступ */
      }

      .buttons-container { 
        padding-bottom: 0; /* Прибираємо зайвий відступ */
        gap: 4px;
      }
      .buttons-container button, 
      .input-area-left .translate-input-button { width: 30px; height: 30px; }

      .buttons-container .translate-input-button { display: none; } /* Переконуємось, що приховано */

      .ollama-chat-menu .model-submenu-section {
        display: block !important; /* Гарантовано показуємо */
    }
    .ollama-chat-menu .model-submenu-section + hr {
         display: block !important; /* Показуємо роздільник */
    }
  }

/* --- Звичайні телефони (портрет) --- */
@media screen and (max-width: 480px) {
  :root {
      --chat-spacing-unit: 3px; /* Ще менша одиниця відступу */
      --chat-avatar-size: 26px; /* Менший аватар */
      --chat-message-max-width: 92%; /* Ще ширші повідомлення */
  }
  .ollama-chat-container {
      padding: calc(var(--chat-spacing-unit) * 3); /* 9px */
      padding-bottom: calc(var(--chat-spacing-unit) * 1); /* 3px */
  }
  .chat-input-container {
      margin: 4px 8px; /* Менші зовнішні відступи */
      padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 2); /* Менші внутрішні відступи */
      border-radius: 10px;
  }
  .chat-input-container textarea {
      font-size: 13px; /* Менший шрифт */
      padding: 8px 10px; /* Менші відступи */
      min-height: 36px;
      
      padding-right: 95px;
  }
  .buttons-container {
    gap: 4px; 
    right: 6px;
    bottom: calc(var(--chat-spacing-unit) * 1.5); /* 4.5px */
  }
  .buttons-container button {
    width: 28px; height: 28px;
  }

  .buttons-container button,
  .input-area-left .translate-input-button {
      width: 28px; height: 28px;
  }
  .input-controls-left, .input-controls-right {
       flex-basis: 45%; /* Дозволяємо групам займати приблизно по половині */
  } 

  /* Ховаємо кнопку перекладу вводу на малих екранах */
  .buttons-container .translate-input-button {
      display: none;
  }

  .ollama-chat-container .message {
      font-size: 13px; /* Менший шрифт повідомлень */
      padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 2.5); /* Менші відступи */
      border-radius: 15px; /* Менший радіус */
  }
  /* Адаптуємо радіуси для послідовних */
  .user-message-group .message:not(:last-child) { border-bottom-right-radius: 4px; }
  .ollama-message-group .message:not(:last-child) { border-bottom-left-radius: 4px; }
  .ollama-chat-container .user-message-group .message:last-child.user-message { border-bottom-right-radius: 15px; }
  .ollama-chat-container .ollama-message-group .message:last-child.ollama-message { border-bottom-left-radius: 15px; }


  .message-group {
      padding-left: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2); /* (26+6 = 32px) */
      padding-right: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2); /* (26+6 = 32px) */
      margin-bottom: calc(var(--chat-spacing-unit) * 3);
  }
   .message-group-avatar {
      bottom: calc(var(--chat-spacing-unit) * 1.5); /* Піднімаємо аватар ближче */
   }

  .message-timestamp {
      font-size: 0.7em; /* Дуже маленький шрифт для дати */
      margin-top: 2px;
  }

   /* Кнопки дій на повідомленнях */
   .message-actions-wrapper {
      top: 2px;
      right: 4px;
      gap: 3px;
   }
   .message-actions-wrapper button .svg-icon {
        width: 12px; height: 12px; /* Дуже маленькі іконки */
   }

  /* Меню */
  .menu-dropdown.ollama-chat-menu {
      min-width: 180px; /* Трохи вужче */
      max-width: calc(100vw - 20px); /* Не вилазити за екран */
  }
  .ollama-chat-menu .menu-option {
      padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 2.5); /* Менші відступи пунктів */
  }
  .ollama-chat-menu .menu-header-item { /* Менші відступи для заголовків підменю */
       padding: calc(var(--chat-spacing-unit) * 1.5) calc(var(--chat-spacing-unit) * 2.5);
  }
   .ollama-chat-menu .submenu-content .menu-option {
       padding-left: calc(var(--chat-spacing-unit) * 2) !important; /* Менший відступ вкладених */
   }
   .ollama-chat-menu .menu-option-text { font-size: 13px; } /* Менший шрифт меню */
   .ollama-chat-menu .chat-option .chat-option-date { font-size: 0.75em; } /* Менший шрифт дати в меню */
   
   .ollama-chat-menu .model-list-container,
   .ollama-chat-menu .role-list-container,
   .ollama-chat-menu .chat-list-container {
        max-height: 150px; /* Обмежуємо висоту списків */
   }
}

/* --- Дуже вузькі екрани --- */
@media screen and (max-width: 360px) {
    :root {
      --chat-avatar-size: 24px;
    }
     .chat-input-container textarea {
         padding-right: 90px; /* Ще менше місця для 3 кнопок (26+3)*3 + 5 */
     }
     .buttons-container {
         gap: 3px;
         right: 6px;
     }
     .buttons-container button {
         width: 26px; height: 26px;
     }
     .message-group {
          padding-left: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2); /* (24+6=30px) */
          padding-right: calc(var(--chat-avatar-size) + var(--chat-spacing-unit) * 2);
     }
     .message-actions-wrapper button .svg-icon { width: 11px; height: 11px; }
}


 /* --- Десктоп (і ширші планшети) --- */
 @media screen and (min-width: 769px) {

  /* Приховуємо секцію вибору моделі у головному меню (...) */
  .ollama-chat-menu .model-submenu-section {
      display: none;
  }
   /* Можливо, прибрати роздільник перед цією секцією */
   .ollama-chat-menu .model-submenu-section + hr {
       display: none;
   }

   .workspace-leaf-content[data-type='ollama-personas-chat-view'] .ollama-container {
    min-height: 65vh; /* Мінімальна висота */
}
}